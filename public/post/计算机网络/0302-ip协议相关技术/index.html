<!doctype html><html lang=zh-CN data-theme=light><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#222" media="(prefers-color-scheme: light)"><meta name=generator content="Hugo 0.148.2"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_16x16.ico><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_32_32.ico><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon_next.png><meta itemprop=name content="3.2 IP 协议相关技术"><meta itemprop=description content="博客，记录生活，分享技术"><meta name=description content="博客，记录生活，分享技术"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="//localhost:1313/imgs/avatar.jpg"><meta itemprop=keywords content="计算机基础,计算机网络,IP"><meta property="og:type" content="article"><meta property="og:title" content="3.2 IP 协议相关技术"><meta property="og:description" content="博客，记录生活，分享技术"><meta property="og:image" content="/imgs/avatar.jpg"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="//localhost:1313/post/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/0302-ip%E5%8D%8F%E8%AE%AE%E7%9B%B8%E5%85%B3%E6%8A%80%E6%9C%AF/"><meta property="og:site_name" content="拾光博客 - 永浩"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="张永浩"><meta property="article:published_time" content="2025-09-26 00:00:00 +0000 UTC"><meta property="article:modified_time" content="2025-09-26 00:00:00 +0000 UTC"><link type=text/css rel=stylesheet href=//localhost:1313/js/3rd/font-awesome/6.7.2/css/all.min.css><link type=text/css rel=stylesheet href=//localhost:1313/js/3rd/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=//localhost:1313/js/3rd/viewerjs/1.11.6/viewer.min.css><link rel=stylesheet href="/css/main.css?=1763308002"><style type=text/css>.post-footer hr:after{content:""}.flinks-list-footer hr:after{content:""}</style><link rel=stylesheet type=text/css href="/css/syntax.css?=1763308002"><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return 0[0];const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),0[0]):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://hm.baidu.com/hm.js?b24e80791ffe27729131ff00ed7471b2",e.async="true",document.head.appendChild(e)})</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><title>3.2 IP 协议相关技术 - 拾光博客 - 永浩</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>拾光博客 - 永浩</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>日积跬步，以致千里</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-categories"><a href=/categories/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>分类</a></li><li class="menu-item menu-item-tags"><a href=/tags/ class=hvr-icon-pulse rel=section><i class="fa fa-tags hvr-icon"></i>标签</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-calendar hvr-icon"></i>归档
<span class=badge>159</span></a></li><li class="menu-item menu-item-commonweal"><a href=/404.html class=hvr-icon-pulse rel=section><i class="fa fa-heartbeat hvr-icon"></i>公益 404</a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><a href=#dns>DNS</a><ul><li><a href=#域名的层级关系>域名的层级关系</a></li><li><a href=#域名解析的工作流程>域名解析的工作流程</a></li></ul></li><li><a href=#arp>ARP</a><ul><li><a href=#arp-确定-mac-地址的过程>ARP 确定 MAC 地址的过程</a></li><li><a href=#rarp-协议>RARP 协议</a></li></ul></li><li><a href=#dhcp>DHCP</a><ul><li><a href=#dhcp-中继代理>DHCP 中继代理</a></li></ul></li><li><a href=#nat>NAT</a><ul><li><a href=#缺点>缺点</a></li><li><a href=#解决-nat-潜在问题的方法>解决 NAT 潜在问题的方法</a></li></ul></li><li><a href=#icmp互联网控制报文协议>ICMP（互联网控制报文协议）</a><ul><li><a href=#功能>功能</a></li><li><a href=#类型>类型</a></li></ul></li><li><a href=#igmp因特网组管理协议>IGMP（因特网组管理协议）</a><ul><li><a href=#igmp-工作机制>IGMP 工作机制</a></li></ul></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=张永浩 src=/imgs/img-lazy-loading.gif data-src=/imgs/avatar.jpg><p class=site-author-name itemprop=name>张永浩</p><div class=site-description itemprop=description>博客，记录生活，分享技术</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>159</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>11</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>36</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"></div><div class="cc-license animated" itemprop=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans class=cc-opacity rel=noopener target=_blank title=共享知识><img src=/imgs/img-lazy-loading.gif data-src=/imgs/cc/big/by_nc_sa.svg alt=共享知识></a></div><div style=cursor:pointer class="button goto-home" title=返回首页 onclick='window.location.href="https://growyears.netlify.app/"'><i class="fas fa-home"></i>
<span style="margin:0 .5em">返回首页</span></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div><div class=item-count id=runTimes data-publishdate="2025-01-08 00:00:00 +0000 UTC"></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>总访客数：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>页面浏览：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count=200619></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times=481></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div><div class=item-count id=last-push-date data-lastpushdate="2025-11-03 00:00:00 +0000 UTC"></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=goto-i18n-translate class=button title=多语言翻译><i class="fas fa-globe"></i></div><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a><a href=https://github.com/CChhaan/my-hugo-blog rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentColor" class="octo-body"/></svg></a><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=//localhost:1313/post/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/0302-ip%E5%8D%8F%E8%AE%AE%E7%9B%B8%E5%85%B3%E6%8A%80%E6%9C%AF/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/avatar.jpg"><meta itemprop=name content="张永浩"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="张永浩"><meta itemprop=description content="博客，记录生活，分享技术"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="3.2 IP 协议相关技术"><meta itemprop=description content="本节详细介绍了 IP 协议相关技术，包括 DNS、ARP、DHCP 和 NAT。"></span><header class=post-header><h1 class=post-title itemprop="name headline">3.2 IP 协议相关技术</h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2025-09-26 00:00:00 +00:00" itemprop="dateCreated datePublished" datetime="2025-09-26 00:00:00 +0000 UTC">2025-09-26
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/ itemprop=url rel=index><span itemprop=name>计算机网络</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="fas fa-solid fa-file-word"></i>
</span><span class=post-meta-item-text>字数：</span>
<span>2464</span>
</span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=busuanzi_value_page_pv data-path=/post/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/0302-ip%E5%8D%8F%E8%AE%AE%E7%9B%B8%E5%85%B3%E6%8A%80%E6%9C%AF/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class="post-body autonumber" itemprop=articleBody>本节详细介绍了 IP 协议相关技术，包括 DNS、ARP、DHCP 和 NAT。
<a id=more></a><h2 id=dns>DNS
<a class=header-anchor href=#dns></a></h2><p>DNS：将域名网址自动转换为具体的 IP 地址的系统。</p><h3 id=域名的层级关系>域名的层级关系
<a class=header-anchor href=#%e5%9f%9f%e5%90%8d%e7%9a%84%e5%b1%82%e7%ba%a7%e5%85%b3%e7%b3%bb></a></h3><p>域名使用句点（.）分隔，越靠右层级越高。</p><p>层级结构类似树状：</p><ul><li>根 DNS 服务器</li><li>顶级域 DNS 服务器（例如 .com）</li><li>权威 DNS 服务器（例如 server.com）</li></ul><p>根域 DNS 服务器信息保存在所有 DNS 服务器中，因此任何 DNS 服务器都能找到根域服务器，客户端只需找到任意一台 DNS 服务器，即可层层查找目标服务器。</p><h3 id=域名解析的工作流程>域名解析的工作流程
<a class=header-anchor href=#%e5%9f%9f%e5%90%8d%e8%a7%a3%e6%9e%90%e7%9a%84%e5%b7%a5%e4%bd%9c%e6%b5%81%e7%a8%8b></a></h3><p>浏览器检查自身缓存 → 操作系统缓存 → 本机 hosts 文件。</p><p>若都无结果，则开始向 DNS 服务器查询：</p><ul><li>客户端向 本地 DNS 服务器 发送请求，询问
<a href=https://www.server.com title=www.server.com rel="noopener external nofollow noreferrer" target=_blank class=exturl>www.server.com
<i class="fa fa-external-link-alt"></i>
</a>的 IP。</li><li>若本地 DNS 有缓存结果，直接返回 IP；若无则向 根域名服务器 查询。</li><li>根域名服务器根据域名后缀（如 .com），返回对应 顶级域名服务器地址。</li><li>本地 DNS 再询问顶级域名服务器。</li><li>顶级域名服务器返回该域的 权威 DNS 服务器地址。</li><li>本地 DNS 继续询问权威 DNS 服务器。</li><li>权威 DNS 服务器 返回
<a href=https://www.server.com title=www.server.com rel="noopener external nofollow noreferrer" target=_blank class=exturl>www.server.com
<i class="fa fa-external-link-alt"></i>
</a>对应的 IP 地址。</li><li>本地 DNS 将结果返回给客户端，客户端与目标主机建立连接。</li></ul><h2 id=arp>ARP
<a class=header-anchor href=#arp></a></h2><p>当主机确定了源 IP 与目标 IP 后，会通过路由表确定<strong>下一跳 IP 地址</strong>。为了在数据链路层传输，还需知道<strong>下一跳的 MAC 地址</strong>。主机通过 ARP 协议向网络请求并获取目标的 MAC 地址。</p><p><strong>ARP</strong> 用于在已知 IP 地址的情况下，<strong>获取对应的 MAC 地址</strong>。</p><h3 id=arp-确定-mac-地址的过程>ARP 确定 MAC 地址的过程
<a class=header-anchor href=#arp-%e7%a1%ae%e5%ae%9a-mac-%e5%9c%b0%e5%9d%80%e7%9a%84%e8%bf%87%e7%a8%8b></a></h3><p>主机通过广播发送 ARP 请求包，包内包含目标主机的 IP 地址。</p><p>同一链路上的设备收到请求后检查目标 IP 是否与自己匹配。若匹配，则将自身 <strong>MAC 地址</strong> 填入 ARP 响应包，返回给请求方。</p><p>操作系统会<strong>缓存第一次获取的 MAC 地址</strong>，以便下次使用。MAC 缓存有有效期，过期后将被清除。</p><h3 id=rarp-协议>RARP 协议
<a class=header-anchor href=#rarp-%e5%8d%8f%e8%ae%ae></a></h3><p><strong>RARP</strong>与 ARP 相反，<strong>已知 MAC 地址求 IP 地址</strong>。</p><p>流程：</p><ul><li>网络中架设 RARP 服务器，注册设备的 MAC 与 IP 映射。</li><li>设备接入网络后，发送请求：“我的 MAC 地址是 XXXX，请告诉我对应的 IP 地址。”</li><li>RARP 服务器收到请求后，返回应答：“MAC 地址为 XXXX 的设备，其 IP 地址是 XXXX。”</li><li>设备依据应答信息设置自身 IP 地址。</li></ul><h2 id=dhcp>DHCP
<a class=header-anchor href=#dhcp></a></h2><p><strong>DHCP</strong>：用于<strong>自动分配 IP 地址及网络配置参数</strong>的协议。客户端监听 <strong>68 端口</strong>，服务器监听 <strong>67 端口</strong>。</p><p>DHCP 工作流程：</p><ul><li><strong>DHCP Discover（发现）</strong>：客户端无 IP 地址，也不知道服务器位置。通过 <strong>UDP 广播通信</strong> 发送发现报文：目的地址：<code>255.255.255.255:67</code>；源地址：<code>0.0.0.0:68</code>，广播传递至网络中所有设备。</li><li><strong>DHCP Offer（提供）</strong>：DHCP 服务器接收请求后，用广播地址响应，报文内容包含：可租用的 IP 地址、子网掩码、默认网关、DNS 服务器、IP 地址租期</li><li><strong>DHCP Request（请求）</strong>：客户端从收到的多个 Offer 中选择一个服务器。向选中的服务器发送请求报文，确认选择。</li><li><strong>DHCP ACK（确认）</strong>：服务器用 ACK 报文应答，确认分配的参数。客户端收到后，即可在租期内使用该 IP 地址。</li></ul><p>租期到期前，客户端发送 DHCP Request 请求：</p><ul><li>若服务器同意，回复 <strong>DHCP ACK</strong>，延长租期。</li><li>若服务器拒绝，回复 <strong>DHCP NACK</strong>，客户端必须停止使用该 IP。</li></ul><p>整个 DHCP 交互过程均使用 UDP 广播通信。</p><h3 id=dhcp-中继代理>DHCP 中继代理
<a class=header-anchor href=#dhcp-%e4%b8%ad%e7%bb%a7%e4%bb%a3%e7%90%86></a></h3><p>若 DHCP 服务器与客户端不在同一局域网内，路由器不会转发广播包。为了解决这一问题，就出现了 DHCP 中继代理：</p><ul><li>客户端向 DHCP 中继代理发送请求。</li><li>中继代理接收广播包后，将其以单播形式转发至 DHCP 服务器。</li><li>服务器向中继代理返回应答。</li><li>中继代理再以广播形式转发应答至客户端。</li></ul><p>即使不在同一链路，DHCP 服务器也能实现统一的 IP 地址分配与管理。</p><h2 id=nat>NAT
<a class=header-anchor href=#nat></a></h2><p>网络地址转换（NAT）是一种缓解 <strong>IPv4 地址耗尽</strong> 问题的技术。</p><p><strong>NAT</strong>：在同一公司、家庭或教室内，主机对外通信时，将 <strong>私有 IP 地址</strong> 转换为 <strong>公有 IP 地址</strong> 的技术。</p><p><strong>NAPT</strong>：由于大多数网络应用使用 TCP 或 UDP 协议，可以将 <strong>IP 地址 + 端口号</strong> 一起进行转换，从而 <strong>使用一个全球 IP 地址</strong> 实现多主机外网通信。</p><p>NAT 路由器通过 <strong>自动生成转换表</strong> 来管理地址与端口的对应关系。</p><h3 id=缺点>缺点
<a class=header-anchor href=#%e7%bc%ba%e7%82%b9></a></h3><p>NAT/NAPT 都依赖自己的转换表，因此存在以下问题：</p><ul><li>外部无法主动与 NAT 内部服务器建立连接（因无转换记录）。</li><li>转换表的生成与转换操作会产生性能开销。</li><li>若 NAT 路由器重启，所有 TCP 连接将被重置。</li></ul><h3 id=解决-nat-潜在问题的方法>解决 NAT 潜在问题的方法
<a class=header-anchor href=#%e8%a7%a3%e5%86%b3-nat-%e6%bd%9c%e5%9c%a8%e9%97%ae%e9%a2%98%e7%9a%84%e6%96%b9%e6%b3%95></a></h3><ol><li>使用 IPv6：</li></ol><p>IPv6 地址空间极大，每台设备都可分配公有 IP 地址，因此不需要地址转换，但 <strong>IPv6 普及仍需时间</strong>。</p><ol start=2><li>NAT 穿透技术：</li></ol><p>NAT 穿透技术可让应用程序主动：发现自己位于 NAT 设备之后，获取 NAT 设备的公有 IP，为自己建立端口映射条目。</p><p>该过程由 <strong>NAT 设备后的应用程序自动完成</strong>：应用程序主动配合 NAT 设备，自行建立映射，使用该条目对外通信，不再需要 NAT 设备进行转换。</p><h2 id=icmp互联网控制报文协议>ICMP（互联网控制报文协议）
<a class=header-anchor href=#icmp%e4%ba%92%e8%81%94%e7%bd%91%e6%8e%a7%e5%88%b6%e6%8a%a5%e6%96%87%e5%8d%8f%e8%ae%ae></a></h2><h3 id=功能>功能
<a class=header-anchor href=#%e5%8a%9f%e8%83%bd></a></h3><p>ICMP 的主要功能包括：确认 IP 包是否成功送达目标地址；报告 IP 包在传输中被废弃的原因；改善网络设置。</p><p>当 IP 包未能到达目标地址时，ICMP 负责通知具体原因。</p><h3 id=类型>类型
<a class=header-anchor href=#%e7%b1%bb%e5%9e%8b></a></h3><p>ICMP 报文分为两类：</p><ul><li><strong>查询报文类型</strong>：用于诊断（查询消息）。</li><li><strong>差错报文类型</strong>：用于通知出错原因（错误消息）。</li></ul><h2 id=igmp因特网组管理协议>IGMP（因特网组管理协议）
<a class=header-anchor href=#igmp%e5%9b%a0%e7%89%b9%e7%bd%91%e7%bb%84%e7%ae%a1%e7%90%86%e5%8d%8f%e8%ae%ae></a></h2><p><strong>IGMP</strong>：用于主机（组播成员）与最后一跳路由器之间的通信。</p><p>主要功能：主机通过 IGMP 报文 <strong>申请加入或退出组播组</strong>。路由器默认不转发组播包，只有当主机通过 IGMP 加入组播组后，路由器才会转发。</p><p><strong>封装与特征</strong>：使用 IP 封装，IP 头部协议号为 <strong>2</strong>，<strong>TTL = 1</strong>，仅限于主机与连接的路由器间通信。</p><h3 id=igmp-工作机制>IGMP 工作机制
<a class=header-anchor href=#igmp-%e5%b7%a5%e4%bd%9c%e6%9c%ba%e5%88%b6></a></h3><p>IGMP 分为三个版本：<strong>IGMPv1、IGMPv2、IGMPv3</strong></p><p>常规查询与响应工作机制</p><ul><li>路由器周期性发送 <strong>目的地址为 224.0.0.1</strong> 的 IGMP 常规查询报文（同网段所有主机和路由器）。</li><li>主机收到查询后启动 <strong>报告延迟计时器</strong>（随机 0 ～ 10 秒）。</li><li>计时器超时后，主机发送 <strong>成员关系报告报文</strong>：源 IP：主机自身地址；目的 IP：组播地址。</li><li>若在计时器超时前收到同组其他主机的报告，则不再发送（避免重复）。</li><li>路由器收到报告后，在 IGMP 路由表中加入该组播组，后续转发对应数据包。</li></ul><p>离开组播组的情况一，网段中仍有该组播组成员：</p><ul><li>主机 1 离开组 <strong>224.1.1.1</strong>，发送 <strong>IGMPv2 离组报文</strong>（目的地址：224.0.0.2，表示所有路由器）。</li><li>路由器收到后，每隔 1 秒连续发送 2 次 <strong>特定组查询报文</strong>，确认是否仍有成员。</li><li>主机 3 仍为该组成员，立即响应查询。</li><li>路由器确认组仍存在，继续转发 224.1.1.1 的组播数据包。</li></ul><p>离开组播组的情况二，网段中无该组播组成员：</p><ul><li>主机 1 离开组 <strong>224.1.1.1</strong>，发送 IGMP 离组报文。</li><li>路由器收到后，每隔 1 秒发送 2 次特定组查询报文。</li><li>若无主机响应，路由器判断该组已不存在。<strong>停止向该网段转发该组播地址的数据包</strong>。</li></ul></div><footer class=post-footer><div class=post-tags><a href=/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/>计算机基础
</a><a href=/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/>计算机网络
</a><a href=/tags/ip/>IP</a></div><div class=post-share-tools><div class=post-share-loading><i class="fa-solid fa-ellipsis fa-spin"></i></div><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><a class=a2a_dd href=https://www.addtoany.com/share></a><a class=a2a_button_wechat></a><a class=a2a_button_qzone></a><a class=a2a_button_sina_weibo></a><a class=a2a_button_douban></a><a class=a2a_button_facebook></a><a class=a2a_button_x></a><a class=a2a_button_email></a><a class=a2a_button_printfriendly></a></div></div><hr><div class=reward-container><div><i class="fa-solid fa-mug-hot"></i>请我喝杯咖啡吧 ヾ(^▽^*)))</div><button>
赞赏</button><div class=post-reward><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/ali-pay.png alt="张永浩 - 支付宝">
<span>支付宝</span></div><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/wechat-pay.png alt="张永浩 - 微信">
<span>微信</span></div></div></div><div class=post-copyright><img src=/imgs/cc/cc.svg class=cc-icon width=75 height=75 align=right alt=共享知识 title=共享知识><ul><li class=post-copyright-title><strong>文章标题：</strong>
3.2 IP 协议相关技术</li><li class=post-copyright-author><strong>本文作者： </strong>张永浩</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=//localhost:1313/post/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/0302-ip%E5%8D%8F%E8%AE%AE%E7%9B%B8%E5%85%B3%E6%8A%80%E6%9C%AF/ title="3.2 IP 协议相关技术">//localhost:1313/post/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/0302-ip%E5%8D%8F%E8%AE%AE%E7%9B%B8%E5%85%B3%E6%8A%80%E6%9C%AF/</a></li><li class=post-copyright-license><strong>版权声明： </strong>本作品采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans>BY-NC-SA</a> 许可协议。转载请注明出处！</li><li><div class=license-icons><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans target=_blank><img src=/imgs/cc/big/by_nc_sa.svg alt=BY-NC-SA title=BY-NC-SA>
</a><a href=https://notbyai.fyi target=_blank><img src=/imgs/notbyai/zh-hans/white.svg title="Not By AI"></a></div></li></ul></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/post/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/0301-ip-%E5%9F%BA%E6%9C%AC%E8%AE%A4%E8%AF%86/ rel=next title="3.1 IP 基本认识"><i class="fa fa-chevron-left"></i> 3.1 IP 基本认识</a></div><div class="post-nav-prev post-nav-item"><a href=/post/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/0214-http2/ rel=prev title="2.14 HTTP/2">2.14 HTTP/2
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div></main><footer class=footer><div class=footer-inner><div id=i18n-translate class=i18n-translate><i class="fa fa-language"></i><div id=lang-select class=lang-select><div id=lang-selected class=selected-option><span class="flag-icon flag-icon-zh-cn"></span>
<span class=selected-language>简体中文</span>
<i class="fa fa-chevron-down"></i></div><div id=lang-options class=lang-options><div class=lang-option lang-code=zh-cn lang-name=简体中文 lang-url=/post/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/0302-ip%E5%8D%8F%E8%AE%AE%E7%9B%B8%E5%85%B3%E6%8A%80%E6%9C%AF/><span class="flag-icon flag-icon-zh-cn"></span>
<span class=lang-name>简体中文</span></div></div></div></div><div class=copyright>&copy;
<span itemprop=copyrightYear>2025
</span><span class=with-love><i class="fa fa-heart"></i>
</span><span class=author itemprop=copyrightHolder>张永浩</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.148.2 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.8.3 target=_blank>Hugo NexT.Gemini</a> 强力驱动</div><div class=beian><a href=https://beian.miit.gov.cn target=_blank></a></div><div class=vendors-list><a target=_blank href=https://app.netlify.com/ title=Netlify><img src=/imgs/img-lazy-loading.gif data-src=/imgs/vendors/Netlify.svg alt=Netlify>
</a><a target=_blank href=https://github.com title=Github><img src=/imgs/img-lazy-loading.gif data-src=/imgs/vendors/github.svg alt=Github>
</a><span>提供CDN/云资源支持</span></div></div></footer><script class=next-config data-name=page type=application/json>{"comments":false,"expired":false,"isHome":false,"isPage":true,"path":"0302-ip%E5%8D%8F%E8%AE%AE%E7%9B%B8%E5%85%B3%E6%8A%80%E6%9C%AF","permalink":"//localhost:1313/post/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/0302-ip%E5%8D%8F%E8%AE%AE%E7%9B%B8%E5%85%B3%E6%8A%80%E6%9C%AF/","title":"3.2 IP 协议相关技术","toc":true}</script><script type=text/javascript src=//localhost:1313/js/3rd/animejs/3.2.2/anime.min.js crossorigin=anonymous defer></script><script type=text/javascript src=//localhost:1313/js/3rd/viewerjs/1.11.6/viewer.min.js crossorigin=anonymous defer></script><script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"copybtn":true,"darkmode":false,"hostname":"//localhost:1313/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"找到 ${hits} 个搜索结果","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"isMultiLang":true,"lang":"zh-CN","lazyload":false,"localSearch":{"enable":true,"limit":1e3,"path":"/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"slideInRight","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":{"enable":false,"plugin":"waline"},"views":{"enable":true,"plugin":"busuanzi"}},"root":"/","scheme":"Gemini","share":{"addtoany":{"js":"https://static.addtoany.com/menu/page.js","locale":"zh-CN","num":8},"enable":true},"sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"vendor":{"plugins":"local","router":{"name":"local","type":"modern","url":"//localhost:1313/js/3rd"}},"version":"4.8.3","waline":{"cfg":{"emoji":false,"imguploader":false,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"serverurl":null,"sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"@waline/client","file":"dist/waline.css","name":"waline","version":"2.15.8"},"js":{"alias":"@waline/client","file":"dist/waline.js","name":"waline","version":"2.15.8"}}}</script><script type=text/javascript src="/js/main.js?=1763308002" defer></script></body></html>