---
# 文章标题
title: 附录 作用域
# 文章内容摘要
# description: 本文详细介绍了 Git 这一分布式版本控制系统的优点，对比了 Windows 与 macOS/Linux 系统下的常用命令，讲解了 vim 操作模式及常用命令，还阐述了 Git 的基本配置、特定项目配置和命令缩写设置等内容。
# 文章内容关键字
keywords: JavaScript 动态作用域，词法作用域，this 绑定，箭头函数 this, catch 块作用域
# 发表日期
date: 2025-06-03
summary: 本节详细介绍了 JavaScript 中作用域的概念，包括动态作用域和词法作用域的区别，以及块作用域的替代方案。此外，还介绍了箭头函数的`this`绑定特性，以及如何用`catch`分句实现块作用域。
# 分类
categories:
  - 你不知道的JS
# 标签
tags:
  - JavaScript
  - ECMAScript
  - 前端开发
---

## 动态作用域

1. **核心逻辑**：不关心函数“在哪里声明”，只关心函数“从哪里调用”——作用域链基于**调用栈**（运行时确定），而非代码的嵌套结构（定义时确定）。
2. **与 JS 的关系**：JS 本身**没有动态作用域**，只有词法作用域；但`this`机制的行为类似动态作用域（`this`指向依赖调用位置，而非定义位置）。
3. **关键区别**：
   - 词法作用域：定义时确定（关注“函数在哪写的”）；
   - 动态作用域：运行时确定（关注“函数在哪调用的”）。

## 块作用域的替代方案（ES6 前）

ES6 前无原生块作用域（`var`声明为函数/全局作用域），可利用**`catch`分句**实现块作用域——`catch`的参数仅在`catch`块内有效，外部无法访问：

```js
{
  try {
    throw undefined; // 主动抛出错误，进入catch块
  } catch (a) {
    // a的作用域仅在catch块内
    a = 2;
    console.log(a); // 输出 2（块内可访问）
  }
}
console.log(a); // 报错：a is not defined（块外不可访问）
```

## `this`词法：箭头函数的`this`绑定

1. **核心特性**：箭头函数不遵循普通函数的`this`绑定规则（如调用位置、`bind`/`call`/`apply`、对象方法绑定等），而是将`this`绑定为**当前词法作用域的`this`**（定义时确定，与外层函数的`this`一致）。
2. **示例解析**：  
   原代码中，`setTimeout`的箭头函数`this`继承自外层`coolFn`的`this`（即`obj`对象）：
   ```js
   var obj = {
     count: 0,
     cool: function coolFn() {
       if (this.count < 1) {
         // 箭头函数this = 外层coolFn的this（obj）
         setTimeout(() => {
           this.count++; // 相当于 obj.count++
         });
       }
     },
   };
   ```
3. **等价写法**（模拟箭头函数的`this`绑定效果）：
   - 方式 1：用`self`保存外层`this`（ES6 前常用）：
     ```js
     var obj = {
       count: 0,
       cool: function coolFn() {
         var self = this; // 保存coolFn的this（obj）
         if (self.count < 1) {
           setTimeout(function timer() {
             self.count++; // 用self访问obj
           });
         }
       },
     };
     ```
   - 方式 2：用`bind(this)`绑定普通函数`this`：
     ```js
     var obj = {
       count: 0,
       cool: function coolFn() {
         if (this.count < 1) {
           setTimeout(
             function timer() {
               this.count++;
             }.bind(this),
             100
           ); // 绑定this为coolFn的this（obj）
         }
       },
     };
     ```
