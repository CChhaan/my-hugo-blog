---
# 文章标题
title: 1.2节 词法作用域和动态作用域
# 文章内容摘要
# description: 本文详细介绍了 Git 这一分布式版本控制系统的优点，对比了 Windows 与 macOS/Linux 系统下的常用命令，讲解了 vim 操作模式及常用命令，还阐述了 Git 的基本配置、特定项目配置和命令缩写设置等内容。
# 文章内容关键字
keywords: JavaScript 词法作用域，静态作用域，eval 函数，with 语句，遮蔽效应，作用域欺骗风险,JavaScript 动态作用域,this 绑定，箭头函数 this,
# 发表日期
date: 2025-05-31
summary: 本节详细介绍了 JavaScript 中词法作用域的概念、核心特性、分类以及欺骗词法作用域的方式和风险，帮助读者更好地理解 JavaScript 的作用域机制，还包括动态作用域和词法作用域的区别，箭头函数的`this`绑定特性。
# 分类
categories:
  - 你不知道的JS
# 标签
tags:
  - JavaScript
  - ECMAScript
  - 前端开发
---

## 词法阶段

词法作用域是定义在 **词法阶段** 的作用域。即作用域由代码中变量和块作用域**书写的位置**决定。当词法分析器处理代码时，会保持作用域不变。

作用域查找会在找到**第一个匹配的标识符**时停止。在多层嵌套作用域中可以定义**同名标识符**，称为 **遮蔽效应**。

查找过程：从运行时所处的最内部作用域开始，逐级向外（或向上）查找，直到遇到第一个匹配的标识符为止。

全局变量会**自动成为全局对象的属性**，可以通过**全局对象属性引用**访问被同名变量遮蔽的全局变量。

**函数的词法作用域**由函数**声明时所处的位置**决定。无论函数**在哪里被调用**或**如何被调用**，其词法作用域始终不变。

词法作用域查找**只会查找一级标识符**。

## 欺骗词法

### eval

`eval()` 可以接受一个字符串参数，并将其内容视为**写在当前位置的代码**。

执行 `eval` 后，引擎仍会进行词法作用域查找，并**不关心代码是动态插入的**。

行为特性：

- 可以通过逻辑动态拼接字符串再传入执行。常用于执行**动态创建的代码**。

- 若执行的字符串中包含声明，则会**修改 `eval` 所处的词法作用域**。

- 在 **严格模式** 下，`eval` 具有**独立的词法作用域**，不会修改外部作用域。

相关机制：

- `setTimeout()` 和 `setInterval()` 的第一个参数可以是字符串，被解释为动态生成的函数代码。
- `new Function()` 的最后一个参数可接受代码字符串并生成函数，前面的参数为形参。

### with

`with` 常被用作引用同一对象多个属性的**快捷方式**，无需重复书写对象名。

`with` 可以将一个对象视为一个**独立的词法作用域**。对象的属性会被视为**该作用域中的词法标识符**。

`with` 块内部的**正常声明**不会被限制在块作用域中，而是被添加到 `with` 所处的**函数作用域**中。

`eval` 会修改所在作用域，而 `with` 会**创建一个全新的词法作用域**。

JS 引擎在编译阶段会根据词法结构进行优化。若出现 `eval` 或 `with`，则无法静态确定变量位置，优化将失效。因此，大量使用 `eval` 或 `with` 的代码**运行速度会显著变慢**。

## 动态作用域

动态作用域不关心函数**声明的位置**，只关心函数**调用的位置**。作用域链基于**调用栈**，而非代码中的嵌套结构。

JavaScript **不具有动态作用域**，它只有词法作用域。但 **this 机制** 与动态作用域的行为类似。

| 对比项   | 词法作用域         | 动态作用域     |
| -------- | ------------------ | -------------- |
| 确定时机 | 写代码时（定义时） | 运行时         |
| 关注点   | 函数在何处声明     | 函数从何处调用 |

**箭头函数**在 `this` 绑定上与普通函数完全不同：它**放弃普通的 this 绑定规则**，而是使用**当前词法作用域**覆盖原有的 this 值。
