---
# 文章标题
title: 1.1节 作用域是什么
# 文章内容摘要
# description: 本文详细介绍了 Git 这一分布式版本控制系统的优点，对比了 Windows 与 macOS/Linux 系统下的常用命令，讲解了 vim 操作模式及常用命令，还阐述了 Git 的基本配置、特定项目配置和命令缩写设置等内容。
# 文章内容关键字
keywords: JavaScript 作用域，编译原理，LHS 查询，RHS 查询，作用域嵌套，ReferenceError, TypeError
# 发表日期
date: 2025-05-27
summary: 本节详细介绍了 JavaScript 中的作用域概念，包括作用域的本质、编译原理、作用域的核心角色、变量声明与赋值过程、LHS 与 RHS 查询、作用域嵌套以及异常类型及触发场景等内容。
# 分类
categories:
  - 你不知道的JS
# 标签
tags:
  - JavaScript
  - ECMAScript
  - 前端开发
---

储存和访问变量值的能力为程序带来了**状态**。

一套用于存储变量并方便后续访问的规则被称为 **作用域**。

## 编译原理

在传统编译语言中，程序在执行前会经历三个步骤，统称为 **编译**：

- **分词 / 词法分析**：将由字符组成的字符串分解成有意义的代码块，称为 **词法单元**。

- **解析 / 语法分析**：将词法单元流数组转换为一个代表程序语法结构的嵌套树，称为 **抽象语法树（AST）**。

- **代码生成**：将 **AST** 转换为可执行代码。

对于 JavaScript，大部分编译过程发生在代码执行前的几微秒内。

## 理解作用域

### 三个核心角色

**引擎**：负责整个 JavaScript 程序的编译及执行。

**编译器**：负责语法分析及代码生成。

**作用域**：负责收集并维护所有声明的标识符集合，并实施规则来确定当前代码是否能访问这些标识符。

### 示例分析：var a = 2

编译阶段：

- 遇到 `var a` 时，编译器会询问作用域中是否已存在名为 `a` 的变量。
- 如果存在，则忽略该声明；如果不存在，则要求作用域声明一个新的变量 `a`。

执行阶段：

- 引擎运行时会询问作用域中是否存在变量 `a`。
- 若存在，则对其赋值为 `2`；若不存在，则继续向上查找该变量。
- 若最终仍未找到变量 `a`，则抛出异常。

变量的赋值操作包含两个步骤：

1. 编译阶段：若变量未声明，则在当前作用域中声明它。
2. 执行阶段：引擎查找该变量，若找到则赋值。

**RHS 查询**：用于查找变量的 **值**。

**LHS 查询**：用于查找变量的 **容器本身**，以便进行赋值操作。

函数声明：编译器可以在代码生成的同时处理函数的 **声明** 和 **值定义**。

## 作用域嵌套

当一个 **块或函数** 嵌套在另一个块或函数中时，就形成了 **作用域嵌套**。

若在当前作用域中找不到变量，引擎会**逐层向外查找**，直到找到该变量或到达最外层作用域。

## 异常

RHS 查询失败：若在所有嵌套作用域中均找不到变量，引擎会抛出 **引用错误（ReferenceError）**。

LHS 查询失败（非严格模式）：若在全局作用域中也找不到目标变量，引擎会**自动创建一个同名全局变量**并返回。

严格模式下的 LHS 查询：严格模式禁止自动创建全局变量。LHS 查询失败时会抛出与 RHS 查询相同的 **引用错误**。

当 RHS 查询成功找到变量，但对其值进行**不合理操作**时，引擎会抛出 **类型异常（TypeError）**。
