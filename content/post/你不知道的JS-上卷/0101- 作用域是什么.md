---
# 文章标题
title: 1.1节 作用域是什么
# 文章内容摘要
# description: 本文详细介绍了 Git 这一分布式版本控制系统的优点，对比了 Windows 与 macOS/Linux 系统下的常用命令，讲解了 vim 操作模式及常用命令，还阐述了 Git 的基本配置、特定项目配置和命令缩写设置等内容。
# 文章内容关键字
keywords: JavaScript 作用域，编译原理，LHS 查询，RHS 查询，作用域嵌套，ReferenceError, TypeError
# 发表日期
date: 2025-05-27
summary: 本节详细介绍了 JavaScript 中的作用域概念，包括作用域的本质、编译原理、作用域的核心角色、变量声明与赋值过程、LHS 与 RHS 查询、作用域嵌套以及异常类型及触发场景等内容。
# 分类
categories:
  - 你不知道的JS
# 标签
tags:
  - JavaScript
  - 作用域
  - 编译原理
  - 前端开发
---

### 程序状态与变量

- 程序状态通过**变量的存储与访问**实现：变量是状态的载体，作用域则决定 “变量在何处可被访问”，两者共同支撑程序的动态执行。

### 作用域的本质

- 作用域是一套管理变量的规则体系，核心解决两个问题：
  1. **变量声明的存储位置**：编译器在编译阶段根据作用域规则，确定变量属于哪个作用域（全局 / 函数 / 块级）。
  2. **变量访问的查找逻辑**：引擎在执行阶段根据作用域规则，从当前作用域向上逐级查找变量。

## 编译原理

### 传统编译三阶段：

- **分词 / 词法分析**：将源代码字符串分解为有意义的词法单元（如关键字、变量名、运算符等）。
- **解析 / 语法分析**：将词法单元流转换为抽象语法树（AST），AST 是体现程序语法结构的嵌套树状结构。
- **代码生成**：将 AST 转换为可执行代码。

### **JavaScript 编译特点**：

JS 是 “即时编译（JIT）” 语言，编译不提前完成，而是在代码执行前的微秒级时间内完成，且编译与执行交替进行（如函数执行前先编译函数内部代码）。

## 作用域的核心角色

- **引擎**：统筹全局，负责代码的编译触发和执行，主导变量的查找与赋值。
- **编译器**：负责语法校验、AST 生成、代码生成，在编译阶段处理变量声明，并告知作用域 “需存储该变量”。
- **作用域**：相当于 “变量仓库”，按规则存储变量，响应引擎的查找请求

## 变量声明与赋值过程（以`var a = 2`为例）

`var a = 2` 并非 “一次性操作”，而是**编译器声明变量**与**引擎执行赋值**两个独立步骤的结合，中间通过作用域衔接：

### 阶段 1：编译器处理变量声明（编译期）

- 步骤 1：编译器在当前作用域中 “查询” 是否存在名为 a 的变量。
  - 若存在：忽略当前声明（`var` 允许重复声明，后续声明会覆盖前序声明的变量，但不会重新初始化）；
  - 若不存在：要求作用域在当前 “变量集合” 中新增一个名为 `a` 的变量（此时 `a` 仅声明，值为 `undefined`）。

### 阶段 2：引擎处理变量赋值（执行期）

- 步骤 1：引擎向当前作用域发起**LHS 查询**（查找变量的 “容器本身”，用于赋值），询问 “是否存在名为 `a` 的变量”。
- 步骤 2：作用域查找结果：
  - 找到 `a`：引擎将 `2` 赋值给 `a`；
  - 未找到 a：
    - 非严格模式：引擎自动在**全局作用域**创建名为 `a` 的变量，再赋值 `2`（变量泄露到全局）；
    - 严格模式（`"use strict"`）：直接抛出 `ReferenceError`（禁止隐式创建全局变量）。

## LHS 与 RHS 查询：

LHS（Left-Hand Side）和 RHS（Right-Hand Side）查询是引擎查找变量的两种核心方式，区别在于 “查找目的”：

- **RHS 查询**：找到变量的 “值”，用于读取。
- **LHS 查询**：找到变量的 “容器”，用于赋值。

**函数声明处理**：编译器在代码生成阶段同步处理函数的声明和值定义。

## 作用域嵌套

当代码嵌套在多个作用域中（如函数嵌套函数、块嵌套块），形成 “作用域链”，引擎按 “就近原则” 查找变量：

### 查找规则

1. 引擎从**当前执行作用域**（如函数执行时的函数作用域、全局代码的全局作用域）开始查找变量；
2. 若当前作用域未找到，向上一级**外层作用域**继续查找；
3. 依次类推，直至抵达**全局作用域**；
4. 若全局作用域仍未找到：
   - RHS 查询：抛出 `ReferenceError`（变量未定义）；
   - LHS 查询：非严格模式创建全局变量，严格模式抛出 `ReferenceError`。

## 异常类型及触发场景

### ReferenceError（引用错误）

- **触发原因**：变量查找失败（作用域链中未找到目标变量），本质是 “变量不存在”。
- 细分场景：
  - RHS 查询失败：无论严格 / 非严格模式，均抛出 `ReferenceError: a is not defined`（如 `console.log(a)` 中 `a` 未声明）；
  - LHS 查询失败：仅严格模式下抛出（非严格模式会隐式创建全局变量）。

### TypeError（类型错误）

- **触发原因**：变量查找成功（RHS 查询找到变量），但对变量的值进行 “不合理操作”，本质是 “变量类型不匹配操作需求”。
