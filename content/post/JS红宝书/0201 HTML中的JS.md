---
# 文章标题
title: 第二章 HTML中的JS
# 文章内容摘要
# description: 本文详细介绍了 Git 这一分布式版本控制系统的优点，对比了 Windows 与 macOS/Linux 系统下的常用命令，讲解了 vim 操作模式及常用命令，还阐述了 Git 的基本配置、特定项目配置和命令缩写设置等内容。
# 文章内容关键字
keywords: script 元素，JavaScript 嵌入方式，defer 与 async, 动态加载脚本，文档模式，noscript 元素
# 发表日期
date: 2025-01-08
summary: 本章详细介绍了 script 元素的使用方式，包括嵌入行内代码和引入外部文件，以及 defer 与 async 属性的使用，以优化脚本执行。同时，还介绍了动态加载脚本、文档模式、noscript 元素等内容。
# 分类
categories:
  - JS红宝书
# 标签
tags:
  - JavaScript
  - HTML
  - 性能优化
  - 前端开发
---

## script 元素

将 **JavaScript** 插入 HTML 的主要方法是使用 **script 元素**。使用方式有两种：

- **在网页中嵌入行内 JavaScript 代码**

- **在网页中包含外部 JavaScript 文件**

### 行内脚本

行内脚本：直接将代码放在 `<script>` 元素中。

**执行顺序**：代码会从上到下依次执行。

**阻塞特性**：在 `<script>` 元素中的代码被计算完成之前，页面的其余内容不会被加载或显示。

行内代码中不能出现字符串 `</script>`。如果必须出现，需使用转义字符 `\`，即 `\<\/script>`。

### 外部脚本

外部脚本：使用 `src` 属性指定外部文件的 **URL**。

文件只需包含要放在 `<script>` 起始和结束标签之间的 JavaScript 代码。

**阻塞特性**：解释外部脚本文件时，页面同样会阻塞。

**扩展名**：外部文件的扩展名（如 `.js`）不是必须的。

**行内与外部互斥**：使用了 `src` 属性的 `<script>` 元素中不应再包含行内代码。浏览器只会下载并执行外部脚本，**忽略行内部分**。

**跨域加载**： `<script>` 的 `src` 可为完整 URL，指向不同域的资源。请求不受同源策略限制，但返回内容的执行受限。请求仍受页面 **HTTP/HTTPS 协议** 限制。 外部域代码被当作加载页面的一部分来执行。

执行顺序：不论代码来源，浏览器都会**按 `<script>` 在页面中出现的顺序**依次解释。前提是 **未使用 `defer` 和 `async` 属性**。

### 标签位置

现代 Web 应用程序通常将所有 `<script>` 引用放在 **`<body>` 元素中内容的末尾**。这样页面会在处理 JavaScript 代码之前完成渲染。

### 推迟执行脚本

**作用**：脚本执行时不会改变页面结构。即脚本会被延迟到整个页面解析完毕后再运行。

**机制**：浏览器会立即下载脚本，但延迟执行，**在 `DOMContentLoaded` 事件之前执行**。

`defer` 属性仅对 **外部脚本文件** 有效。

### 异步执行脚本

**作用**：浏览器无需等待脚本下载和执行即可继续加载页面。

**特性**：

- 脚本间**执行顺序不确定**，不保证按照出现顺序执行。
- 脚本会在 **`load` 事件前执行**，但可能在 `DOMContentLoaded` 之前或之后。
- 启用 `async` 后表示不会使用 `document.write`。

### 动态加载脚本

可通过 **DOM API** 动态创建并插入 `<script>` 元素。这种方式创建的 `<script>` 默认 **异步加载**，相当于添加了 `async` 属性。

动态加载的资源对 **浏览器预加载器** 不可见，可能降低加载优先级。为了让预加载器识别这些文件，可在文档头部显式声明：

```html
<link rel="preload" href="“xxx.js”" />
```

## 行内代码与外部文件

推荐使用外部 JavaScript 文件，理由如下：

- **可维护性**：将代码集中存放在专用目录中，便于独立维护。
- **缓存性**：浏览器可缓存外部脚本，多个页面可复用同一文件，从而**减少下载量、加快加载速度**。

## 文档模式

IE5.5 发明了文档模式（Document Mode）的概念，可通过 `doctype` 切换。

**三种模式**：

1. **混杂模式（Quirks Mode）**：模拟 IE5 行为，支持非标准特性。
2. **标准模式（Standards Mode）**：兼容标准行为。
3. **准标准模式（Almost Standards Mode）**：支持大部分标准特性，但不完全严格。

**触发条件**：

- 混杂模式：省略文档开头的 `doctype`。
- 标准模式：使用完整文档类型声明。
- 准标准模式：使用过渡型或框架集文档类型。

## noscript 元素

**作用**：为不支持 JavaScript 的浏览器提供替代内容。

**内容限制**：可包含任何可出现在 `<body>` 中的 HTML 元素（不含 `<script>`）。

**显示条件**：

- 浏览器 **不支持脚本**。
- 浏览器 **禁用脚本**。

满足任一条件时，`<noscript>` 中的内容会被渲染；否则不会显示。
