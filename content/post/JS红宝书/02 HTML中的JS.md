---
# 文章标题
title: 第二章 HTML中的JS
# 文章内容摘要
# description: 本文详细介绍了 Git 这一分布式版本控制系统的优点，对比了 Windows 与 macOS/Linux 系统下的常用命令，讲解了 vim 操作模式及常用命令，还阐述了 Git 的基本配置、特定项目配置和命令缩写设置等内容。
# 文章内容关键字
keywords: script 元素，JavaScript 嵌入方式，defer 与 async, 动态加载脚本，文档模式，noscript 元素
# 发表日期
date: 2025-01-08
summary: 本章详细介绍了 script 元素的使用方式，包括嵌入行内代码和引入外部文件，以及 defer 与 async 属性的使用，以优化脚本执行。同时，还介绍了动态加载脚本、文档模式、noscript 元素等内容。
# 分类
categories:
  - JS红宝书
# 标签
tags:
  - JavaScript
  - HTML
  - 性能优化
  - 前端开发
---

## script 元素：JS 插入 HTML 的核心方式

script 元素是嵌入或引入 JS 代码的主要载体，分为“嵌入行内代码”和“引入外部文件”两种用法，且需遵循特定执行规则。

### 两种使用方式

| 类型         | 实现方式                                                  | 关键注意事项                                                                                                                                                                                                                                                                                        |
| ------------ | --------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 嵌入行内代码 | 代码直接放在`<script>`与`</script>`之间                   | - 代码从上到下解释，执行期间阻塞页面加载/显示；<br>- 代码中不可直接出现`</script>`，需用转义（如`\<\/script>`）；<br>- 示例：`<script>console.log("hi");</script>`                                                                                                                                  |
| 引入外部文件 | 通过`src`属性指定外部 JS 文件 URL（如`src="example.js"`） | - 外部文件仅需包含 JS 代码（无需`<script>`标签）；<br>- 执行期间阻塞页面，阻塞时间含文件下载时间；<br>- 浏览器不检查`.js`扩展名（非必需，但为惯例）；<br>- 若同时写`src`和行内代码，仅执行外部文件，忽略行内代码；<br>- `src`可指向外部域资源（如`<script src="https://xxx.com/xxx.js"></script>`） |

### 执行顺序

浏览器按`<script>`在页面中**出现的顺序**依次解释执行（无论嵌入还是引入外部文件）。

## script 标签位置：影响页面渲染

- **传统位置**：早期放在`<head>`中，会导致 JS 执行时页面未渲染（因 JS 阻塞加载），出现“空白页”；
- **现代推荐位置**：放在`<body>`元素内**页面内容之后**（如`</body>`闭合前），确保页面完全渲染后再执行 JS，避免阻塞视觉呈现。

## 脚本执行控制：defer 与 async 属性

两者均用于优化脚本执行（减少页面阻塞），仅对**外部脚本文件**有效，核心差异在“执行时机”和“顺序性”。

| 属性  | 下载行为               | 执行时机                                                                 | 执行顺序       | 关键说明                                                                    |
| ----- | ---------------------- | ------------------------------------------------------------------------ | -------------- | --------------------------------------------------------------------------- |
| defer | 立即下载（不阻塞页面） | 页面完全解析完毕后、`DOMContentLoaded`事件前执行                         | 按脚本出现顺序 | 脚本不修改页面结构（否则可能导致 DOM 操作异常）；多个 defer 脚本按顺序执行  |
| async | 立即下载（不阻塞页面） | 下载完成后立即执行，可能在`DOMContentLoaded`之前或之后、`load`事件前执行 | 不保证顺序     | 脚本不可用`document.write`（可能覆盖页面内容）；多个 async 脚本执行顺序随机 |

## 动态加载脚本

通过 JS 创建`<script>`元素引入外部文件，默认异步加载，可手动控制加载行为。

### 基础实现

```js
let script = document.createElement("script");
script.src = "gibberish.js"; // 外部JS文件路径
script.async = false; // 设为false则按插入顺序执行（默认true，异步）
document.head.appendChild(script); // 插入到<head>中执行
```

### 性能优化：预加载声明

动态加载的脚本对浏览器“预加载器”不可见，可能影响资源优先级。需在`<head>`中显式声明预加载，提升加载效率：

```html
<link rel="preload" href="gibberish.js" />
<!-- 告诉浏览器提前加载该JS文件 -->
```

## 行内代码 vs 外部文件：推荐外部文件

优先使用外部 JS 文件，核心优势如下：

1. **可维护性**：所有 JS 集中在独立文件/目录，独立于 HTML 编辑，避免代码分散导致的维护困难；
2. **缓存优化**：浏览器缓存外部 JS 文件，多页面共用同一文件时仅下载一次，减少重复请求，加快页面加载；
3. **兼容性**：外部文件语法在 HTML 和 XHTML 中一致，无需适配不同文档类型；
4. **HTTP2/SPDY 适配**：在现代协议下，轻量独立的 JS 组件可批量传输，与单一大文件加载延迟相近，更灵活。

## 文档模式：影响浏览器渲染与 JS 行为

### 模式分类

- **混杂模式（Quirks Mode）**：让浏览器模拟旧版 IE（如 IE5）行为，支持非标准特性，由“省略`<doctype>`声明”触发；
- **标准模式（Standards Mode）**：浏览器按 W3C 标准渲染页面，行为规范，由“正确的`<doctype>`声明”（如`<!DOCTYPE html>`）触发；
- **准标准模式（Almost Standards Mode）**：支持多数标准特性，但规则稍宽松，由“过渡性/框架集`<doctype>`”触发。

### 对 JS 的影响

主要通过 CSS 渲染间接影响（如盒模型计算方式），但部分 JS API（如`document.compatMode`）可检测文档模式，用于适配不同渲染行为。

## noscript 元素：脚本禁用时的降级方案

- **作用**：当“浏览器不支持 JS”或“JS 支持被关闭”时，渲染`<noscript>`内的 HTML 内容（如提示“请开启 JS 以正常使用”）；若 JS 可用，则忽略该元素内容。
- **用法**：可包含任何`<body>`内的 HTML 元素（除`<script>`外），示例：
  ```html
  <noscript>
    <p>您的浏览器不支持JavaScript，请开启后重试。</p>
  </noscript>
  ```
