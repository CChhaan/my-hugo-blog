---
# 文章标题
title: 6. 合并分支
# 文章内容摘要
# description: 本文详细介绍了 Git 这一分布式版本控制系统的优点，对比了 Windows 与 macOS/Linux 系统下的常用命令，讲解了 vim 操作模式及常用命令，还阐述了 Git 的基本配置、特定项目配置和命令缩写设置等内容。
# 文章内容关键字
keywords: Git merge, Git rebase, 合并分支, git merge 命令, git rebase 命令, Git 冲突处理, Git 快转合并, fast-forward, rebase 与 merge 区别, Git reflog, 恢复删除分支, Git ORIG_HEAD, Git 冲突解决, ours theirs 冲突, Git 分支管理, Git 历史记录优化
# 发表日期
date: 2025-07-06
summary: 本文主要介绍了 Git 合并分支的方法，包括使用 merge 和 rebase 合并分支，以及如何处理合并冲突。
# 分类
categories:
  - Git从入门到精通
# 标签
tags:
  - Git
  - 版本控制系统
---

## 使用 merge 合并分支

如果想要用 **master** 分支来合并 **cat** 分支，需要先切换回 master 分支，再使用 `git merge` 命令。

```bash
git merge cat
```

合并后，落后的 master 分支会和 cat 分支处于同一个 commit。

假设从 master 分支创建了 cat 和 dog 两个分支，并且当前在 cat 分支：

- master 合并 cat 或 dog → **快转模式（fast-forward）**，master 直接收割成果。
- cat 与 dog 互相合并 → Git 会生成一个 **额外的 commit**，该 commit 会指向两个父 commit。

谁合并谁，两个分支上的 commit 都是对等的。

差别在于：

- 谁合并谁，谁的分支就会往前移动。
- 额外生成的 commit 对象中会记录两个 parent，合并方向决定顺序。

使用 `--no-ff` 参数可避免快转模式，强制生成一个新的 commit 对象。

这样做出来的 commit 对象一样会指向前面的两个 commit。

合并过的分支是否保留可自行决定。**删除分支只是移除一张贴纸，不影响原 commit。**
所谓合并分支，其实是合并 **分支指向的 commit**，而不是分支本身。

## 恢复已被删除但未合并的分支

分支只是一个指向某个 commit 的指标，删除分支不会使 commit 消失。

删除分支后，commit 仍存在，只是若未记下 SHA-1 值，不易再利用。

```bash
git branch new_branch SHA-1
```

如果未记录 SHA-1 值，可用 `git reflog` 查找。reflog 默认保留 **30 天**，在此期间可找回。

## 使用 rebase 合并分支

`git rebase` 的含义是 **重新定义分支的参考基准**，功能与 `git merge` 类似。

例如：cat 和 dog 两个分支的基准都是 master。使用 `git rebase`：

```bash
git rebase dog
```

含义：cat 分支重新定义基准，dog 分支作为新的基准。

**过程：**

- 把 cat 分支的 commit 接到 dog 分支上。
- 重新计算 commit 的 **SHA-1**，生成新的 commit 对象。
- cat 分支指向新的 commit，HEAD 继续指向 cat。
- 原本的 commit 依然存在，只是没有分支指向，最终可能被 Git 回收。

**影响：**谁 rebase 谁，会造成历史记录顺序不同。

### 取消 rebase

- 对于一般合并：

```bash
git reset HEAD^ --hard
```

删除合并 commit，回到合并前状态。

- 对于 rebase

可通过以下方式取消：

1. 使用 `git reflog` 找到 rebase 前的最后动作，用 `reset` 切回。
2. 使用 **ORIG_HEAD** 记录点回退。

### rebase 的特点

**优点**

- 不会产生额外的合并 commit。
- 历史记录顺序更直观，可由 rebase 的方向决定。

**缺点**

- 不如 merge 直观。
- 出错后不易 reset。
- 发生冲突时会卡在中途。

对于未推出去但较乱的 commit，常先 rebase 整理再推出去。

**rebase = 改动历史记录**。对已推出去的内容，如无必要，尽量不要 rebase。

## 处理冲突

Git 可以检测简单冲突：并非修改同一文件就冲突，只有修改同一行才会冲突。

### merge 冲突

Git 会标记冲突段落：上面是 HEAD（当前分支内容），中间是分隔线，下面是其他分支内容。

**解决步骤：**

1. 修改冲突部分，去掉标记。
2. 将文件重新加入暂存区。
3. commit 完成合并。

### rebase 冲突

rebase 过程中发生冲突会卡住，HEAD 不指向任何分支。

修改文件后加入暂存区，继续 rebase：

```bash
git add 文件
git rebase --continue
```

### 非文本文件冲突

若为图像等二进制文件：

使用自己的文件：

```bash
git checkout --ours 文件名
```

使用别人的文件：

```bash
git checkout --theirs 文件名
```

之后将文件加入暂存区，准备 commit，结束冲突处理。
