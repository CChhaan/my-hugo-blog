---
# 文章标题
title: 8. 修改历史记录
# 文章内容摘要
# description: 本文详细介绍了 Git 这一分布式版本控制系统的优点，对比了 Windows 与 macOS/Linux 系统下的常用命令，讲解了 vim 操作模式及常用命令，还阐述了 Git 的基本配置、特定项目配置和命令缩写设置等内容。
# 文章内容关键字
keywords: Git 修改提交历史, git commit --amend, git rebase -i, Git 互动模式, 合并 commit, 拆分 commit, 调整 commit 顺序, 删除 commit, git revert, git reset, 修改历史记录, Git rebase 教程, Git 历史回退, Git 历史重写
# 发表日期
date: 2025-07-08
summary: 本文主要介绍了 Git 修改历史记录的方法，包括如何修改最后一次提交、使用互动模式修改更早的历史记录、把多个 commit 合并为一个、把一个 commit 拆分为多个、在两个 commit 之间插入新的 commit、删除或调整 commit 顺序以及 revert 的使用等。
# 分类
categories:
  - Git从入门到精通
# 标签
tags:
  - Git
  - 版本控制系统
---

## 修改历史信息

### 用 `--amend` 修改最后一次提交

只能修改**最后一次 commit** 的信息。

```bash
git commit --amend
```

### 使用互动模式修改更早的历史记录

可使用 `git rebase` 的互动模式来改动过去的历史记录。

```bash
git rebase -i SHA-1
```

`-i`：进入 rebase 的互动模式。`SHA-1`：表示从当前到该 commit 的范围。

进入后会弹出 **vim 编辑器**。

编辑器中的顺序与 `git log` 结果**相反**。

`pick`：保留这次 commit，不改动。

`reword`（或 `r`）：修改 commit 信息。

修改后保存并退出，会弹出另一个 vim 编辑器以修改 commit 信息。
保存并退出后，git 会自动完成剩下的操作。

修改 commit 信息后，**SHA-1 值会改变**。

被修改的 commit 会成为新的对象。

**之后的所有 commit** 都会重新生成新的 commit 对象。

如果要取消当前 rebase，可执行：

```bash
git reset ORIG_HEAD --hard
```

即可回到 rebase 之前的状态。

## 把多个 commit 合并为一个

使用互动模式的 rebase：

- 将 `pick` 改为 `squash`。
- 被标记为 `squash` 的 commit 会与前一行的 commit 合并。
- 保存并退出后，会进入编辑器重新编写合并后的 commit 信息。

## 把一个 commit 拆分为多个

使用互动模式的 rebase，将 `pick` 改为 `edit`。当 rebase 执行到该 commit 时会暂停。

使用以下命令重置该 commit：

```bash
git reset HEAD^
```

使用多次 `add` + `commit` 将内容分成多个 commit。

执行以下命令让 rebase 继续：

```bash
git rebase --continue
```

## 在两个 commit 之间插入新的 commit

使用互动模式的 rebase，将 `pick` 改为 `edit`。

当执行到该 commit 时会暂停。

添加新的 commit。继续执行 rebase

**注意**：rebase 状态下的 commit 列表顺序与正常日志相反，需确认停下的点是否正确。

## 删除或调整 commit 顺序

使用互动模式的 rebase：

- **调整顺序**：直接调整列表中 commit 的顺序。
- **删除 commit**：
  - 将 `pick` 改为 `drop`，或直接删除该行。

**注意**：删除或调整顺序时需考虑 commit 的相依性。

## revert

取消最后一次 commit：

```bash
git revert HEAD --no-edit
```

`--no-edit`：不编辑 commit 信息。

该操作会**新增一个 commit** 来撤销目标 commit，原 commit 仍保留。

### 取消 revert

- **再开一个 revert**

  - 对刚才的 revert 再执行一次 revert。

- 直接使用 reset

```bash
git reset HEAD^ --hard
```

可回到 revert 之前的状态。

### 适用场景

**单人项目**：通常直接使用 `reset`。

**多人协作项目**：若不允许使用 `reset` 或 `rebase` 修改历史，可使用 `revert` 生成一个反向操作的 commit。

### 三个指令的区别

| 指令       | 作用                             | 是否修改历史         | 适用场景                 |
| ---------- | -------------------------------- | -------------------- | ------------------------ |
| **reset**  | 修改当前状态到指定 commit        | ✅ 是                | 尚未推送的 commit        |
| **rebase** | 编辑、删除或整理历史记录         | ✅ 是                | 尚未推送的 commit        |
| **revert** | 新增一个 commit 来反转之前的内容 | ❌ 否（新增 commit） | 已推送或禁止改历史的情形 |
