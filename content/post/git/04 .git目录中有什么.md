---
# 文章标题
title: 4. git目录中有什么
# 文章内容摘要
# description: 本文详细介绍了 Git 这一分布式版本控制系统的优点，对比了 Windows 与 macOS/Linux 系统下的常用命令，讲解了 vim 操作模式及常用命令，还阐述了 Git 的基本配置、特定项目配置和命令缩写设置等内容。
# 文章内容关键字
keywords: Git 对象, Git HEAD, Git SHA-1, Git Blob, Git Tree, Git Commit, Git Tag, Git 分支, detached head, Git reflog, Git 对象存储, Git 快照, Git 压缩打包, git gc, Git 内部原理
# 发表日期
date: 2025-07-04
summary: 本文主要介绍了 Git 目录中的内容，包括 HEAD、SHA-1 值、Git 中的对象、git 在 checkout 时的变化等内容。
# 分类
categories:
  - Git从入门到精通
# 标签
tags:
  - Git
  - 版本控制系统
---

## head 是什么

**HEAD 是一个指标，指向某一个分支**，通常可以当作当前所在分支。

在 `.git` 目录中有一个名为 **head** 的文件，其中记录的就是 HEAD 的内容。

**HEAD 特点**：

- 通常指向当前所在分支
- 不一定总是指向分支，当未指向分支时会出现 **detached head** 状态
- 在切换分支时，HEAD 内容会改变
- 当 HEAD 改变时，**reflog 会留下记录**

## SHA-1 值

**SHA-1 值**是一种杂凑算法，结果为 **40 个十六进制数字**。

特点：

- 相同输入 → 相同输出
- 不同输入 → 不同输出

**Git 中所有对象的编号都是用 SHA-1 产生的**。

### SHA-1 值会重复吗

**相同输入**：相同结果，不代表重复。

**不同输入，相同结果**：称为 **碰撞**。发生概率极低。

Git 计算时不仅使用文件内容，还会额外加内容，进一步降低碰撞概率。

### 对象 SHA-1 计算方式

- **Blob 对象**计算模式：
  1. blob 字样
  2. 一个空白字节
  3. 输入内容的长度
  4. null 结束符
  5. 输入内容
- **Tree / Commit / Tag**：第一项改成对应的对象名。

## git 中的对象

Git 有四种重要对象：**Blob、Tree、Commit、Tag**

### Blob 对象

当文件加入暂存区，Git 在 `.git` 中生成 blob 对象

存储规则：

- **前 2 个字节 → 目录名**
- **后 38 个字节 → 文件名**

文件内容经过压缩，一般编辑器无法直接查看

使用命令查看：

```bash
git cat-file -t SHA-1值   # 查看对象类型
git cat-file -p SHA-1值   # 查看对象内容
```

关键点：

- `git add` 时，计算 SHA-1 并存储
- 使用前两位作为目录，后 38 位作为文件名
- 内容存放于 `.git/object`
- 文件内容是压缩后的结果
- **空目录无法加入 Git**，但空文件可以（内容为空）

### Tree 对象

**文件**以 blob 存放

**目录及文件名**以 tree 存放

Tree 对象会指向：

- 一个或多个 blob
- 一个或多个其他 tree

这种关系称为 **DAG（有向无环图）**

### commit 对象

包含信息：

- 某个 tree（根目录的 tree）
- 提交时间
- 作者和提交者（一般相同）
- 提交信息

### 分支

分支像一张“贴纸”，贴在某个 commit 上，并随 commit 移动

**HEAD 指向某个分支**，可理解为当前分支

特点：

- 新的 commit 会包含 `parent` 指向前一次 commit
- commit → tree → blob/tree
- 除第一个 commit 外，所有 commit 都指向前一次 commit
- 内容相同的文件，视为同一个 blob

### tag

**手动添加**，不会在 commit 过程中自动出现

Tag 对象包含：

- 作者
- 时间
- 标记的 commit

**必须是附注 tag** 才会生成对象

### 总结

**文件内容 → Blob**

**目录与文件名 → Tree**

**提交记录 → Commit**（指向 Tree 和前一个 Commit）

**标记 → Tag**（指向 Commit）

**分支**：指向某个 Commit（不属于对象）

**HEAD**：指向某个分支（不属于对象）

推送到远端后，在 `.git/refs/remote` 中存放远端分支（同样指向 Commit）

## git 在 checkout 时的变化

`.git/objects` 保留完整内容

**工作目录内容会根据当前 commit 还原**

切换到无分支 commit → 进入 **detached head** 状态

Git 根据对象信息还原目录和文件

### git 不是做差异备份

其他系统：保存差异，通过拼接还原

Git：**保存完整对象**

- 文件内容哪怕改 1 个字，都会生成新的 blob
- checkout 时直接还原整串对象，效率高
- 类似“快照”

### 资源回收机制

Git 会在对象过多时自动压缩与打包

手动触发：git gc

打包后存放在 `.git/objects/pack`

可用底层命令查看：git verify-pack

显示内容：

- 第一栏：SHA-1
- 第二栏：对象类型
- 第三栏：文件大小

打包时使用类似差异的方式压缩体积

### 触发时机

- `.git/objects` 目录或 packfile 数量过多
- 执行 `git push` 推送至远端
