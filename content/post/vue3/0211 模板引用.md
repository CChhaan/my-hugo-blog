---
# 文章标题
title: 2.11 模板引用
# 文章内容摘要
# description:
# 文章内容关键字
keywords: Vue ref, Vue 模板引用, Vue 组件引用, Vue defineExpose, Vue useTemplateRef, Vue 函数模板引用, Vue v-for ref, Vue DOM 操作, Vue 组合式 API, Vue 模板访问
# 发表日期
date: 2025-04-11
summary: 本文主要介绍了 Vue 3 中的模板引用，包括如何访问模板引用、组件上的 ref、v-for 中的模板引用、函数模板引用等内容。
# 分类
categories:
  - vue3文档阅读
# 标签
tags:
  - vue
  - vue3
  - 前端框架
  - 前端开发
---

## 模板引用 (`ref`)

Vue 的声明性渲染模型抽象了大部分 DOM 操作，但有时仍需要直接访问底层 DOM 元素。
**`ref` 是一个特殊的 attribute**，允许在 DOM 元素或子组件实例被挂载后，获得对它的直接引用。
常见用途：

- 在组件挂载时将焦点设置到 input 元素
- 在元素上初始化第三方库

## 访问模板引用

在组合式 API 中，可使用 `useTemplateRef()`获取引用。

使用 TypeScript 时，Vue 会根据模板中 `ref` attribute 的元素或组件，自动推断 `input.value` 的类型。

在 **3.5 之前**的版本，需要手动声明与模板中 `ref` 匹配的引用。

如果不使用 `<script setup>`，需从 `setup()` 返回 `ref`。

**注意**：

- 只能在组件**挂载后**访问模板引用。
- 如果侦听模板引用的变化，需要考虑其值可能为 **`null`**。

## 组件上的 ref

模板引用也可以用在子组件上，此时引用的值是**组件实例**。

如果子组件：

- 使用 **选项式 API** 或

- 未使用 `<script setup>`

  → 那么被引用的组件实例与子组件的 `this` 一致，父组件可访问子组件的所有属性和方法。

⚠️ 这会导致父子组件之间的紧密耦合，应只在**绝对需要时**使用组件引用。常规情况下，应优先使用 **props** 和 **emit** 实现父子交互。

例外：

- 使用 `<script setup>` 的组件是**默认私有**的。
- 父组件无法访问其中任何内容，除非子组件通过 **`defineExpose`** 显式暴露。
- `defineExpose` 必须在任何 **`await`** 操作之前调用，否则暴露的属性和方法无法访问。

## `v-for` 中的模板引用

在 `v-for` 中使用模板引用时，ref 的值是一个**数组**。

挂载后，数组包含整个列表对应的所有元素。

**注意**：ref 数组的顺序 **不保证**与源数组一致。

## 函数模板引用

`ref` attribute 也可以绑定为一个函数。

在每次组件更新时，该函数都会被调用，并接收元素引用作为第一个参数。

需要使用 **动态绑定 `:ref`** 才能传入函数。

当绑定的元素被卸载时，函数也会被调用一次，此时参数 `el` 为 **`null`**。

可以绑定组件方法而不是内联函数。
