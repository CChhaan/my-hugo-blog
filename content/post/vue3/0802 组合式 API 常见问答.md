---
# 文章标题
title: 8.2 组合式 API 常见问答
# 文章内容摘要
# description:
# 文章内容关键字
keywords: Vue 组合式 API, Composition API, 响应式 API, 生命周期钩子, 依赖注入, <script setup>, 逻辑复用, 大型项目维护, TypeScript 类型推导, 生产包体积优化, 选项式 API, Vue 与 React Hooks 对比, Vue 代码组织
# 发表日期
date: 2025-04-21
summary: 本文介绍了组合式 API 的特点、优势、与选项式 API 的关系、与 React Hooks 的对比等内容。
# 分类
categories:
  - vue3文档阅读
# 标签
tags:
  - vue
  - vue3
  - 前端框架
  - 前端开发
---

## 什么是组合式 API

**组合式 API (Composition API)** 是一系列 API 的集合，使我们可以使用函数而不是声明选项的方式书写 Vue 组件。

它涵盖以下方面：

- **响应式 API**：如 `ref()`、`reactive()`，用于创建响应式状态、计算属性和侦听器。
- **生命周期钩子**：如 `onMounted()`、`onUnmounted()`，用于在组件生命周期阶段添加逻辑。
- **依赖注入**：如 `provide()`、`inject()`，结合响应式 API 使用 Vue 的依赖注入系统。

在 Vue 3 中，组合式 API 通常配合 `<script setup>` 语法使用。

**组合式 API 并不是函数式编程**：

- 组合式 API 基于 Vue 的响应性系统（数据可变、细粒度）。
- 函数式编程通常强调数据不可变。

## 为什么要有组合式 API

### 更好的逻辑复用

通过 组合函数 实现简洁高效的逻辑复用。

解决了 mixins 的缺陷。

### 更灵活的代码组织

**选项式 API 的限制**：

- 多个逻辑关注点被拆分到不同选项中，阅读和重构成本高。
- 抽取逻辑时需在多个位置寻找代码片段。

**组合式 API 的改进**：

- 相同逻辑关注点的代码被组织到一起。
- 方便移动到外部文件，降低重构成本。
- 更适合大型项目的长期维护。

### 更好的类型推导

使用变量和函数，天然类型友好。

代码可享受完整的类型推导，减少类型标注需求。

TypeScript 和 JavaScript 用户都能受益。

### 更小的生产包体积

`<script setup>` 与组合式 API 更高效，代码压缩更友好。

模板被编译为内联函数，与 `<script setup>` 代码同作用域。

不依赖 `this`，可直接访问变量。

**优势**：本地变量名可压缩，对象属性名不能。

## 与选项式 API 的关系

**组合式 API**：

- 不限制代码放置位置，可运用 JavaScript 最佳实践。
- 提供更好的长期可维护性。

**选项式 API**：

- 允许“少思考”，但被锁定在固定模式中。
- 在大型项目中难以重构或提高质量。

### 组合式 API 是否覆盖了所有场景

组合式 API 能覆盖所有状态逻辑需求。

仅需保留少量选项：`props`、`emits`、`name`、`inheritAttrs`。

可配置编译时标记移除选项式 API 代码，减小包体积。

### 可以在同一个组件中使用两种 API 吗

可以在选项式 API 组件中通过 `setup()` 使用组合式 API。

**推荐场景**：已有大量选项式 API 代码，但需与组合式 API 或第三方库整合。

### 选项式 API 会被废弃吗

**不会废弃**。

选项式 API 仍是 Vue 的重要组成部分，适合中小型项目。

组合式 API 更适合大型项目。

## 与 Class API 的关系

**不推荐在 Vue 3 使用 Class API**。

理由：组合式 API 提供了更好的 TypeScript 集成、逻辑复用和代码组织能力。

## 和 React Hooks 的对比

### React Hooks 特点与问题

- 每次更新时重新调用。
- 严格的调用顺序，不可写在条件分支中。
- 闭包变量易“过期”，依赖数组复杂且 ESLint 校验不足。
- 昂贵计算需 `useMemo`，依赖数组需正确维护。
- 事件函数传递给子组件会导致**不必要的更新**，需 `useCallback` 优化。
- 变量闭包与并发特性导致推理困难，需 `useRef` 保持可变状态。

### 组合式 API 优势

- `setup()` 或 `<script setup>` 的代码仅调用一次。
- 不依赖闭包变量，不限制调用顺序，可条件调用。
- 响应性系统自动收集依赖，无需手动声明。
- 无需缓存回调函数，细粒度响应性确保必要更新。
- **开发体验更直观，优化负担更小**。
