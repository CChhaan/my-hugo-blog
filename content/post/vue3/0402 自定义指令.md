---
# 文章标题
title: 4.2 自定义指令
# 文章内容摘要
# description:
# 文章内容关键字
keywords: Vue 自定义指令, Vue 指令钩子, Vue DOM 操作, Vue 组合式 API, Vue 生命周期钩子, Vue 指令参数, Vue 全局注册指令, Vue 指令使用场景, Vue 指令优化, Vue 内置指令比较
# 发表日期
date: 2025-04-16
summary: 本文主要介绍了 Vue 3 中的自定义指令，包括指令钩子、钩子参数、简化形式、对象字面量、在组件上使用等。通过阅读本文，读者可以了解如何在 Vue 3 中使用自定义指令，以及如何优化指令的使用。
# 分类
categories:
  - vue3文档阅读
# 标签
tags:
  - vue
  - vue3
  - 前端框架
  - 前端开发
  - 组件化开发
---

## 自定义指令

**Vue 内置指令**：如 `v-model`、`v-show`。

**自定义指令**：用于复用涉及普通元素的底层 DOM 访问逻辑。

**与其他复用方式的比较**：

- 组件：主要构建模块。
- 组合式函数：侧重有状态逻辑。
- 自定义指令：专注底层 DOM 操作逻辑。

自定义指令由一个包含类似组件生命周期钩子的对象来定义。

钩子函数接收**指令绑定元素**作为参数。

在 `<script setup>` 中：任何以 `v` 开头的驼峰命名变量都可作为自定义指令。

不使用 `<script setup>`：通过 `directives` 选项注册。

可在应用层级全局注册。

## 自定义指令的使用时机

**推荐**：尽可能使用 `v-bind` 等内置指令。

**自定义指令的使用场景**：只有当功能**只能通过直接 DOM 操作实现**时才使用。

**原因**：内置指令更高效，对服务端渲染更友好。

## 指令钩子

一个指令的定义对象可以提供以下钩子函数（均为可选）

```js
const myDirective = {
  // 在绑定元素的 attribute 前
  // 或事件监听器应用前调用
  created(el, binding, vnode) {
    // 下面会介绍各个参数的细节
  },
  // 在元素被插入到 DOM 前调用
  beforeMount(el, binding, vnode) {},
  // 在绑定元素的父组件
  // 及他自己的所有子节点都挂载完成后调用
  mounted(el, binding, vnode) {},
  // 绑定元素的父组件更新前调用
  beforeUpdate(el, binding, vnode, prevVnode) {},
  // 在绑定元素的父组件
  // 及他自己的所有子节点都更新后调用
  updated(el, binding, vnode, prevVnode) {},
  // 绑定元素的父组件卸载前调用
  beforeUnmount(el, binding, vnode) {},
  // 绑定元素的父组件卸载后调用
  unmounted(el, binding, vnode) {},
};
```

### 钩子参数

**`el`**：指令绑定的元素，用于直接操作 DOM。

**`binding`**：对象，包含：

- `value`：传递给指令的值。例如 `v-my-directive="1 + 1"` → 值为 `2`。
- `oldValue`：之前的值，仅 `beforeUpdate` 和 `updated` 可用。无论是否更改都存在。
- `arg`：指令参数。例如 `v-my-directive:foo` → 参数为 `"foo"`。
- `modifiers`：修饰符对象。例如 `v-my-directive.foo.bar` → `{ foo: true, bar: true }`。
- `instance`：使用该指令的组件实例。
- `dir`：指令的定义对象。

**`vnode`**：绑定元素的 VNode。

**`prevVnode`**：之前渲染中的 VNode，仅 `beforeUpdate` 和 `updated` 可用。

**注意事项：**

- 除 `el` 外，其他参数只读，不可更改。
- 需在不同钩子间共享信息时，推荐通过元素的 dataset 实现。
- 自定义指令的参数也可为动态值。

## 简化形式

若仅在 `mounted` 和 `updated` 中实现相同行为，可直接用**函数**定义指令。

## 对象字面量

自定义指令可以接收多个值。

可以向指令传递 JavaScript 对象字面量。

指令可接收任意合法的 JavaScript 表达式。

## 在组件上使用

**不推荐**：在组件上使用自定义指令。

行为：

- 当组件有单个根节点时，自定义指令会应用到根节点（类似透传 attributes）。
- 当组件有多个根节点时，指令会被忽略并抛出警告。

**限制**：指令不能像 attribute 一样通过 `v-bind="$attrs"` 传递到其他元素。
