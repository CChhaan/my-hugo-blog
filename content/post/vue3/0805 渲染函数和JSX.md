---
# 文章标题
title: 8.5 渲染函数和 JSX
# 文章内容摘要
# description:
# 文章内容关键字
keywords: Vue 渲染函数, Vnodes, h() 函数, hyperscript, JSX, TSX, 函数式组件, Vue JSX, Vue TSX, 响应式状态, setup, Vue 组件开发, Vue 高级用法, 渲染函数返回值, Vue props
# 发表日期
date: 2025-04-23
summary: 本文介绍了 Vue 3 中渲染函数和 JSX 的基本用法，包括如何创建 Vnodes、声明渲染函数、Vnodes 必须唯一、函数式组件、JSX / TSX 以及函数式组件的使用方式。
# 分类
categories:
  - vue3文档阅读
# 标签
tags:
  - vue
  - vue3
  - 前端框架
  - 前端开发
---

在绝大多数情况下，Vue 推荐使用**模板语法**来创建应用。
然而在某些需要完整 JavaScript 编程能力的场景下，**渲染函数**就派上用场了。

## 基本用法

### 创建 Vnodes

Vue 提供了 `h()` 函数用于创建 vnodes。

`h` 是 **hyperscript** 的简称，意为“能生成 HTML 的 JavaScript”。更准确的名称是 `createVNode()`，但 `h()` 更简洁。

**`h()` 的使用方式**：

```JS
// 类型必填，其他参数可选
h('div')
h('div', { id: 'foo' })

// attribute 和 property 都能在 prop 中书写
// Vue 会自动将它们分配到正确的位置
h('div', { class: 'bar', innerHTML: 'hello' })

// 像 `.prop` 和 `.attr` 这样的的属性修饰符
// 可以分别通过 `.` 和 `^` 前缀来添加
h('div', { '.name': 'some-name', '^width': '100' })

// 类与样式可以用数组或对象
h('div', { class: [foo, { bar }], style: { color: 'red' } })

// 事件监听器应以 onXxx 的形式书写
h('div', { onClick: () => {} })

// children 可以是字符串
h('div', { id: 'foo' }, 'hello')

// 没有 props 可省略
h('div', 'hello')
h('div', [h('span', 'hello')])

// children 数组可包含 vnode 与字符串
h('div', ['hello', h('span', 'hello')])
```

得到的 vnode 为如下形式：

```JS
const vnode = h('div', { id: 'foo' }, [])

vnode.type      // 'div'
vnode.props     // { id: 'foo' }
vnode.children  // []
vnode.key       // null
```

### 声明渲染函数

在使用模板时，`setup()` 返回值用于暴露数据给模板。

在渲染函数中，**可以直接返回渲染函数**。

渲染函数能够访问同一作用域内的 **props** 和响应式状态。

除了返回 vnode，还可以返回 **字符串或数组**。

⚠️ 注意：

- **必须返回一个函数而不是值**。
- `setup()` 每个组件只调用一次，返回的渲染函数会被多次调用。
- 如果组件不需要实例状态，可以直接声明为一个函数。

### Vnodes 必须唯一

组件树中的 **vnodes 必须唯一**。

如果需要渲染多个重复的元素或组件，可以使用**工厂函数**。

## JSX / TSX

JSX 是 JavaScript 的一种类似 XML 的扩展：

```jsx
const vnode = <div id={dynamicId}>hello, {userName}</div>;
```

在 JSX 中，使用 **大括号 `{}`** 嵌入动态值。

JSX 语法本身没有定义运行时语义，可编译为多种输出形式。

Vue JSX 转换方式 **不同于 React**，不可混用。

主要区别：

- 可以直接使用 `class` 和 `for`，无需 `className` 或 `htmlFor`。
- 传递子元素（如 slots）的方式不同。

Vue 提供了 TSX 类型推导支持。需要在 `tsconfig.json` 中设置： `"jsx": "preserve"`

## 函数式组件

**函数式组件**：自身没有任何状态的组件。

特点：

- 接收 props，返回 vnodes。
- 不会创建组件实例（没有 `this`）。
- 不触发常规生命周期钩子。

使用方式

- 用普通函数而非选项对象创建函数式组件。
- 该函数就是组件的渲染函数。
- 函数式组件的签名与 `setup()` 相同。

大多数常规组件的配置不可用，只有：`props`、`emits`

如果未定义 `props`：

- `props` 对象会包含所有 attribute。
- prop 名不会自动转换为驼峰。
- 若未定义 `props`，仅 `class`、`style`、`onXxx` 会从 `attrs` 中继承。可以设置 `inheritAttrs: false` 禁用继承。

如果定义了 `props`：attribute 透传 与普通组件相同。

函数式组件可像普通组件一样注册和使用。当 `h` 的第一个参数为函数时，该函数会被视为函数式组件。
