---
# 文章标题
title: 5.3 KeepAlive 组件
# 文章内容摘要
# description:
# 文章内容关键字
keywords: Vue KeepAlive, Vue 动态组件缓存, Vue 组件状态保持, Vue include exclude, Vue 最大缓存实例, Vue LRU 缓存组件, Vue 组件激活钩子, Vue 组件生命周期
# 发表日期
date: 2025-04-18
summary: 本文主要介绍了 Vue 3 中的 `<KeepAlive>` 组件，用于在多个组件间动态切换时缓存被移除的组件实例，并详细解释了其分类、包含/排除、最大缓存实例数以及缓存实例的生命周期等特性。
# 分类
categories:
  - vue3文档阅读
# 标签
tags:
  - vue
  - vue3
  - 前端框架
  - 前端开发
  - 组件化开发
---

## `<KeepAlive>` 组件

`<KeepAlive>` 是一个内置组件，用于在多个组件间动态切换时 **缓存被移除的组件实例**。

动态组件的实现：通过 `<component>` 元素。

**默认行为**：

- 组件实例在被替换后会被销毁。
- 组件销毁后，其内部所有已变化的状态都会丢失。
- 当组件再次显示时，会创建一个带有 **初始状态** 的新实例。

**解决方案**：使用 `<KeepAlive>` 包装动态组件以缓存实例。

**DOM 内模板写法**：需写为 `<keep-alive>`。

## 包含/排除

**默认行为**：缓存内部所有组件实例。

**定制方式**：通过 `include` 和 `exclude` prop。

- 可选值：
  - 英文逗号分隔的字符串
  - 正则表达式
  - 包含上述类型的数组

**匹配依据**：根据组件的 `name`选项。

**要求**：若组件需要条件性缓存，必须显式声明 `name` 选项。

**Vue 3.2.34+ 特性**：

- 使用 `<script setup>` 的单文件组件会自动根据文件名生成对应的 `name` 选项，无需手动声明。

## 最大缓存实例数

通过 `max` prop 限制缓存的最大组件实例数。

**行为特点**：

- 在指定 `max` 时，`<KeepAlive>` 的行为类似 **LRU 缓存**。
- 当缓存数量即将超过最大值时，**最久未被访问的实例将被销毁**，以便为新的实例腾出空间。

## 缓存实例的生命周期

**状态变化**：

- 当组件实例从 DOM 移除但被 `<KeepAlive>` 缓存时 → 变为 **不活跃**，而不是被卸载。
- 当组件实例再次插入 DOM 时 → 被重新 **激活**。

**生命周期钩子**：

- `onActivated()`
- `onDeactivated()`

**注意事项**：

- `onActivated` 在组件挂载时也会调用。`onDeactivated` 在组件卸载时也会调用。
- 这两个钩子适用于 `<KeepAlive>` 缓存的 **根组件和后代组件**。
