---
# 文章标题
title: 3.7 依赖注入
# 文章内容摘要
# description:
# 文章内容关键字
keywords: Vue provide inject, prop 逐级透传, Vue 依赖注入, Vue provide 使用, Vue inject 使用, provide inject 响应式, Vue Symbol 注入名, Vue 组件通信, Vue 状态共享, Vue 插件依赖注入
# 发表日期
date: 2025-04-12
summary: 本文主要介绍了 Vue3 的依赖注入，包括 provide 和 inject 的使用方法，以及如何使用 Symbol 作为注入名。
# 分类
categories:
  - vue3文档阅读
# 标签
tags:
  - vue
  - vue3
  - 前端框架
  - 前端开发
  - 组件化开发
---

## Prop 逐级透传问题

当需要从父组件向子组件传递数据时，会使用 **props**。

如果组件层级很深，某个深层子组件需要祖先组件的数据，则必须逐级透传 props。这种情况被称为 **“prop 逐级透传”**，是我们希望避免的。

**解决方式：**使用 **provide / inject**：

- 父组件作为依赖提供者。
- 任意后代组件（无论层级多深）都可以注入该依赖。

## Provide (提供)

使用 `provide()`为组件后代提供数据。

如果不使用 `<script setup>`，必须在 `setup()` 中同步调用。

**参数说明：**

**第一个参数**：注入名

- 类型：字符串或 `Symbol`
- 作用：供后代组件查找依赖
- 一个组件可多次调用 `provide()`，使用不同注入名。

**第二个参数**：提供的值

- 类型：任意，包括响应式状态（如 `ref`）
- 作用：提供响应式状态时，后代组件可与提供者保持响应式联系。

## 应用层 Provide

可以在**整个应用层面**提供依赖。

应用级提供的数据可被该应用内的所有组件注入。

特别适用于插件，因为插件通常不会使用组件形式提供值。

## Inject (注入)

使用 `inject()`注入上层组件提供的数据。

如果多个父组件提供了相同键，**就近原则**：解析为最近父组件的值。

**注意：**

如果提供的值是 `ref`：

- 注入的是 **ref 对象本身**，不会自动解包。
- 注入方组件可通过 ref 保持响应性链接。

如果不使用 `<script setup>`，必须在 `setup()` 内同步调用。

### 注入默认值

默认情况下，如果注入名未被提供，会抛出运行时警告。

可以声明一个**默认值**，类似 props。

默认值可能需要通过函数或类初始化 → 可使用 **工厂函数**避免不必要的计算。

第三个参数：标识默认值应作为工厂函数使用。

## 和响应式数据配合使用

**建议**：将响应式状态的变更保持在供给方组件中。状态声明与变更内聚在供给方 → 更易维护。

在注入方更改数据时：推荐由供给方提供更改数据的方法函数。

如果需要确保数据不可更改：使用 `readonly()` 包装提供的值。

## 使用 Symbol 作注入名

在大型应用或组件库中，建议使用 **Symbol 作为注入名**，避免冲突。

推荐在单独文件中导出这些注入名 Symbol。
