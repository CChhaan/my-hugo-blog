---
# 文章标题
title: 2.9 HTTP 版本
# 文章内容摘要
# description:
# 文章内容关键字
keywords: HTTP/1.1 性能优化, HTTP/2 特性, HTTP/3 协议, HTTP 协议演进, HTTP 队头阻塞, QUIC 协议, HTTP 长连接, 多路复用, 头部压缩 HPACK, 二进制帧, 服务器推送, TCP 与 UDP 区别, QUIC 连接迁移, HTTP/2 缺陷, HTTP/3 优化, TLS 1.3, 0-RTT 握手, HTTP 性能提升, 网络协议优化, HTTP 与 QUIC
# 发表日期
date: 2025-09-23
summary: 本节详细介绍了 HTTP 协议的各个版本及其性能改进，包括 HTTP/1.1、HTTP/2 和 HTTP/3 的特点与优化。
# 分类
categories:
  - 计算机网络
# 标签
tags:
  - 计算机基础
  - 计算机网络
  - HTTP协议
---

## HTTP/1.1 相比 HTTP/1.0 的性能改进

性能提升：

- **使用长连接**：改善了 HTTP/1.0 短连接造成的性能开销。
- **支持管道（Pipeline）网络传输**：第一个请求发出后，不必等待响应即可发送第二个请求，减少整体响应时间。

性能瓶颈：

- **请求 / 响应头部未经压缩**，首部信息越多延迟越大，只能压缩 Body。
- **冗长首部重复发送**，造成带宽浪费。
- **按顺序响应请求**，响应慢会导致客户端长时间等待，出现**队头阻塞**。
- **无请求优先级控制**。
- **请求必须由客户端发起**，服务器只能被动响应。

## HTTP/2 的优化

HTTP/2 协议基于 **HTTPS**，安全性有保障。

性能改进包括：**头部压缩、二进制格式、并发传输、服务器推送**。

### 头部压缩（HPACK）

HTTP/2 会压缩 Header，自动消除重复部分。

**HPACK 算法**：客户端与服务器同时维护头信息表，所有字段存入表中并生成索引号，后续仅发送索引号，提高传输速度。

### 二进制格式

不再使用 HTTP/1.1 的纯文本报文，**全面采用二进制格式**，头信息与数据体均为二进制，统称为 **帧（Frame）**：头信息帧和数据帧。

无需再解析明文报文，直接处理二进制，提高数据传输效率。

### 并发传输（多路复用）

HTTP/1.1：请求-响应模型，同一连接需串行执行，易出现**队头阻塞**。

HTTP/2：引入 **Stream** 概念，多个 Stream 复用一条 TCP 连接。

结构层级：

- **TCP 连接** → 包含多个 Stream。
- **Stream** → 包含 1 个或多个 Message。
- **Message** → 对应 HTTP/1 的请求或响应（含头部与包体）。
- **Frame** → HTTP/2 最小单位，以二进制压缩格式存放数据。

每个请求分配唯一 **Stream ID**，不同 Stream 的帧可乱序发送，再由接收端按 ID 组装，可**并行交错地发送请求与响应**。

### 服务器推送

改善传统「请求 - 应答」模式，**服务器可主动推送资源**。

双方都可建立 Stream：客户端 Stream ID 为奇数，服务器 Stream ID 为偶数。

## HTTP/2 的缺陷

HTTP/2 基于 **TCP 协议**，TCP 是 **字节流协议**，要求数据完整、连续。

若「前 1 个字节」未到达，后续字节只能暂存于内核缓冲区，只有前一个字节到达后，HTTP/2 才能从内核中读取数据。

一旦发生丢包，会触发 TCP **重传机制**，阻塞同连接中的所有请求。这就是 **HTTP/2 队头阻塞问题**。

## HTTP/3 的优化

队头阻塞问题的来源：

- **HTTP/1.1 阶段**：管道（Pipeline）仅解决请求阻塞，响应仍按顺序返回，服务端慢导致**响应队头阻塞**（HTTP 层）。
- **HTTP/2 阶段**：多请求复用 TCP 连接，但丢包会阻塞所有请求，形成**TCP 层队头阻塞**。

核心改进：更换底层协议，HTTP/3 将下层 **TCP 改为 UDP**。

**UDP 无序、不保证交付**，因此不会产生 TCP 队头阻塞问题。

通过基于 UDP 的 **QUIC 协议** 实现类似 TCP 的可靠传输。

QUIC 有以下 3 个特点：无队头阻塞、更快的连接建立、连接迁移

### 无队头阻塞

QUIC 引入 **Stream 与多路复用**，可并发传输多个 Stream。

每个 Stream 独立，若某个流丢包，仅阻塞该流，其余流不受影响。

不同于 HTTP/2：HTTP/2 中任一流丢包会阻塞所有请求。

### 更快的连接建立

HTTP/1 与 HTTP/2 的问题：TCP 与 TLS 分层：TCP 属于传输层，TLS 属于表示层，二者无法合并，需分批握手：**先 TCP 三次握手，再 TLS 四次握手**。

HTTP/3 的改进：

- 使用 **QUIC 协议握手**，仅需 **1 RTT**，握手目的是确认双方 **连接 ID**（用于连接迁移）。
- QUIC 内部集成 TLS，不再分层，使用 **TLS 1.3**，可在 **1 RTT** 完成连接与密钥协商。
- 二次连接时，可实现 **0-RTT**，同时发送应用数据与握手信息。

### 连接迁移

TCP 的问题：连接由四元组（源 IP、源端口、目的 IP、目的端口）唯一标识。当网络切换（如 4G → WiFi）时，IP 改变会导致连接断开。重新连接需：TCP 三次握手、TLS 四次握手、TCP 慢启动，用户体验卡顿明显。

QUIC 不使用四元组绑定连接，而使用 **连接 ID（Connection ID）**，双端各自持有一组连接 ID。 即使网络切换、IP 改变，只要上下文（连接 ID、TLS 密钥等）存在， 即可**无缝复用原连接**，无重连、无卡顿。

QUIC 是一个基于 **UDP 的伪 TCP + TLS + HTTP/2 多路复用协议**。

由于部分网络设备不识别 QUIC，仅视其为 UDP 数据包，导致 **UDP 包可能被丢弃**，从而引发新的兼容性问题。
