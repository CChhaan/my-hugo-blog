---
# 文章标题
title: 2.13 HTTPS如何优化
# 文章内容摘要
# description:
# 文章内容关键字
keywords: TLS 性能优化, HTTPS 性能提升, TLS 握手优化, ECDHE 密钥交换, TLS 1.3 优化, AES-NI 加速, ChaCha20 性能, ECC 证书, OCSP Stapling, 会话复用, Session ID, Session Ticket, Pre-shared Key, 0 RTT 连接, 前向安全性, TLS False Start, x25519 曲线, AES_128_GCM, TLS 证书优化, HTTPS 加密性能, 网络延时优化
# 发表日期
date: 2025-09-24
summary: 本节详细介绍了 HTTPS 的优化方法，包括分析性能损耗、硬件优化、软件优化和协议优化等。
# 分类
categories:
  - 计算机网络
# 标签
tags:
  - 计算机基础
  - 计算机网络
  - HTTP协议
---

## 分析性能损耗

性能消耗的两个环节：

- **TLS 协议握手过程**
- **握手后的对称加密报文传输**

第二环节：对称加密性能：主流对称加密算法：**AES**、**ChaCha20**性能不错，一些 CPU 厂商针对这些算法进行了硬件级优化，因此，该环节的性能消耗 **非常小**。

第一个环节：TLS 握手性能消耗：TLS 握手不仅增加网络延时（**最长可达 2 RTT**），还会在以下步骤中产生性能损耗：

- 客户端和服务端临时生成椭圆曲线公私钥（ECDHE 密钥协商算法）。
- 客户端验证证书时，访问 CA 获取 **CRL** 或 **OCSP**，验证证书是否被吊销。
- 双方计算 **Pre-Master（对称加密密钥）**。

## 硬件优化

HTTPS 协议是 **计算密集型**，非 I/O 密集型，因此，应投资于 **CPU** 而非网卡、硬盘等。

**高性能 CPU** 可提升计算速度，加速 TLS 握手过程。

优先选择支持 **AES-NI 特性** 的 CPU，可在指令级别优化 AES 算法，加速加解密。

若 CPU 支持 AES-NI，应选择 **AES 算法**；若不支持 AES-NI，应选择 **ChaCha20 算法**，因其对 CPU 更友好。

## 软件优化

软件优化分为两种方式：

- **软件升级**：将使用的软件升级至最新版本，最新版本通常包含性能优化和问题修复。

- **协议优化**：通过优化密钥交换算法与 TLS 版本实现性能提升。

## 协议优化

### 密钥交换算法优化

RSA 密钥交换的缺陷：TLS 1.2 使用 RSA 密钥交换算法需 **4 次握手（2 RTT）**，不具备 **前向安全性**，因此，RSA 握手过程 **慢且安全性不高**。

建议使用 **ECDHE 密钥交换算法** 替换 RSA。

ECDHE 支持 **False Start**（抢跑机制），客户端可在 **第 3 次握手后、第 4 次握手前** 发送加密应用数据，将握手往返由 **2 RTT 减少至 1 RTT**，同时具备 **前向安全性**。

ECDHE 基于椭圆曲线，不同曲线性能不同。推荐使用 **x25519 曲线**（目前最快）。

若安全要求不高，可使用 **AES_128_GCM**，其速度快于 **AES_256_GCM**。

### TLS 升级

TLS 1.2 的握手过程：需 **4 次握手（2 RTT）**：Client Hello、Server Hello、公钥交换（第 3、第 4 次握手），之后双方计算出会话密钥。

TLS 1.3 的改进：将 **Hello 与公钥交换** 合并为一个消息，**仅需 1 RTT** 即可完成握手。

客户端在 **Client Hello** 中携带支持的椭圆曲线与公钥，服务端选择曲线并返回公钥后，双方即可生成会话密钥。具备更高的 **安全性与效率**。

TLS 1.3 的安全增强：

- 废除不具备前向安全性的 **RSA** 和 **DH** 算法，仅支持 **ECDHE**。

- 对对称加密与签名算法仅保留 **最安全的密码套件**。
- 通过减少不安全算法，防止 **降级攻击**（中间人伪造 Client Hello）。

## 证书优化

### 证书传输优化

目标：**减小证书体积**，以节约带宽并降低计算开销。

应选择 **椭圆曲线（ECDSA）证书** 而非 RSA 证书，因为在相同安全强度下，**ECC 密钥更短**。

### 证书验证优化

证书验证过程复杂，包括：证书链逐级验证、用 CA 公钥解密证书、用签名算法验证证书完整性、向 CA 查询证书吊销状态（CRL 或 OCSP）。

该过程涉及 HTTP 请求，造成 **DNS 查询、连接建立、数据收发** 等额外延时。

#### CRL

CRL ：由 CA 定期更新的吊销证书序号列表。

CRL 存在两大问题：

- **实时性差**：更新周期内吊销信息可能未反映。
- **性能差**：列表随吊销证书增多而变大，导致下载与遍历速度慢。

#### OCSP

向 CA 实时查询证书有效性，不需下载整个 CRL 列表，**解决了实时性问题**。

但仍需网络请求，若网络不佳或 CA 繁忙，会造成延时。

#### OCSP Stapling（OCSP 辅助验证）

服务器周期性向 CA 查询证书状态，获得签名响应并缓存。

客户端连接时，服务器将该响应一并发送。客户端可直接验证证书状态，无需再向 CA 查询。由于响应带签名，服务器无法篡改。

## 会话复用

TLS 握手的目的是协商出 **对称加密密钥**，若将首次握手协商出的密钥缓存，下次连接时直接复用，即可显著减少性能损耗。

### Session ID（会话 ID）

工作原理：首次握手后，客户端与服务器缓存会话密钥：使用唯一的 **Session ID** 标识会话（key-value 关系）。再次连接时，客户端携带 Session ID，服务器若找到匹配项，则直接恢复会话，仅需 **1 次往返**。

缺点：

- 服务器需保存每个客户端会话，内存压力随连接数增加。
- 负载均衡场景下，客户端可能连接到不同服务器，需重新完整握手。

### Session Ticket（会话票据）

服务器不再缓存会话密钥，而是将会话密钥加密为 **Ticket**，发送给客户端缓存。客户端下次连接时携带 Ticket，服务器解密后恢复会话。

集群环境中，各服务器必须使用相同的加密密钥。

Session ID 与 Ticket 均 **不具备前向安全性**，若密钥泄漏，历史通信可被破解。需设定合理的会话过期时间，防止 **重放攻击**。

### Pre-shared Key（预共享密钥）

TLS 1.3 的会话复用方式，可实现 **0 RTT 重连**。

客户端在重连时将 **Ticket 与 HTTP 请求** 一同发送。

存在 **重放攻击风险**，需通过以下方式缓解：

- 为会话密钥设定合理的过期时间；
- 仅对安全请求（如 **GET / HEAD**）启用会话重用。
