---
# 文章标题
title: 3.4 断网了，还能 ping 通 127.0.0.1 吗？
# 文章内容摘要
# description:
# 文章内容关键字
keywords: 127.0.0.1, localhost, 0.0.0.0, 回环地址, IPv4, IPv6, ping命令, ICMP协议, TCP协议区别, 网络层与传输层, ping原理, ping本机, 网络调试, 原始套接字, 回环接口lo0, 本地网络测试, 断网ping通原因, 网络协议栈, ksoftirqd
# 发表日期
date: 2025-09-27
summary: 本节详细解释了为什么断网了还能 ping 通 127.0.0.1，以及 ping 回环地址与 ping 本机地址的区别，以及 127.0.0.1 和 localhost 以及 0.0.0.0 的区别。
# 分类
categories:
  - 计算机网络
# 标签
tags:
  - 计算机基础
  - 计算机网络
  - IP
---

## 什么是 127.0.0.1

**127.0.0.1** 是 **IPv4** 地址中的一个特殊地址，属于回环地址。

**IPv4 地址**：总共有 32 位，分成 4 个字节（每字节 8 位），以 `.` 隔开。

**回环地址**：以 `127` 开头的地址都属于回环地址，用于指向本机。

**IPv6 地址**：回环地址为 `::1`，连续的 0 会被省略，且只能有一个 `::`。

**ping 命令**：

- 在 **IPv4** 下，使用 `ping 127.0.0.1` 来测试本机的回环地址。
- 在 **IPv6** 下，使用 `ping6 ::1` 来测试回环地址。

## 什么是 ping

**ping** 是一个应用层命令，用于测试目标主机是否可达， 通过 ICMP 协议进行通信。

**工作原理**：通过 ICMP 协议发送一个小的消息包，判断目标机器的网络是否通畅。

**ICMP**：网络层协议，用于传递控制消息。

## TCP 发数据和 ping 的区别

**ping** 和其他应用层软件一样，都是应用层的程序。

**ping 与 TCP 的主要区别**：

1. **Socket 创建**：
   - TCP：`socket(AF_INET, SOCK_STREAM, 0)`，面向字节流的 TCP 协议，工作在传输层。
   - ping：`socket(AF_INET, SOCK_RAW, IPPROTO_ICMP)`，原始套接字，工作在网络层。
2. **数据流动**：
   - TCP 数据通过用户态和内核态之间的 **sendto** 调用传递，进入传输层、网络层，最终加上 MAC 头通过网卡发送。
   - ping 使用原始套接字构建 ICMP 数据包，并通过类似路径发出，最终加上 ICMP 和 IP 头，发送数据包。

**总结**：ping 通过模拟正常数据流的方式，自己构建数据包，由系统按照 TCP 数据传输的路径发送。

## 为什么断网了还能 ping 通 127.0.0.1

**回环地址**：`127.0.0.1` 属于回环地址，不需要通过网络接口发送数据到外部网络。

**工作流程**：

1. 目标 IP 是回环地址时，系统选择 **本地网卡**（"假网卡"）来发送数据。
2. **假网卡** 处理消息并将其推送到 `input_pkt_queue` 链表中，触发软中断。
3. **ksoftirqd** 内核线程处理软中断，将数据包通过网络协议栈返回应用程序。

**结论**：即使断网，回环地址仍能正常 ping 通，因为数据完全在本机内处理。

## ping 回环地址与 ping 本机地址的区别

**ping 本机 IP 和 ping 回环地址**：都使用本地回环接口（**lo0**），也叫 **假网卡**。

**相同点**：数据不会发送到网络，都会在本机网络协议栈内转发并回传。

没有实际区别，都是走本机的本地回环接口。

## 127.0.0.1 和 localhost 以及 0.0.0.0 有区别吗

**localhost**：

- 不是一个 IP 地址，而是一个域名。
- 默认解析为 `127.0.0.1`，可以通过修改 `/etc/hosts` 文件来更改。

**127.0.0.1**：

- 与 `localhost` 等价，都是本机的回环地址。

**0.0.0.0**：

- **0.0.0.0** 是无效的目标地址，在 IPv4 中不能用于 ping。
- **用途**：在服务器启动时，通常会将监听地址设置为 `0.0.0.0`，表示监听本机所有的 IPv4 地址。
- **客户端连接**：不能使用 `0.0.0.0` 来连接服务器，必须指定具体的服务器 IP 地址。
