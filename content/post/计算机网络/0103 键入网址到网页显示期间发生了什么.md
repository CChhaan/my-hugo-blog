---
# 文章标题
title: 1.3 键入网址到网页显示期间发生了什么
# 文章内容摘要
# description:
# 文章内容关键字
keywords: HTTP协议, DNS解析, 域名解析流程, 协议栈, TCP连接, TCP三次握手, TCP四次挥手, IP协议, MAC地址, ARP协议, 网卡, 交换机, 路由器, 数据封装过程, 网络传输原理, 网络通信流程, 浏览器请求过程, URL解析, 网络包传输, 网络分层模型, TCP/IP协议栈
# 发表日期
date: 2025-09-18
summary: 本节详细介绍了从输入网址到网页显示期间，计算机内部发生的详细过程，包括 DNS 解析、HTTP 请求、TCP 连接、IP 数据包传输、MAC 地址解析等步骤。
# 分类
categories:
  - 计算机网络
# 标签
tags:
  - 计算机基础
  - 计算机网络
---

## HTTP

浏览器第一步工作是解析 URL，以生成发送给 Web 服务器的 HTTP 请求信息。

**URL 指向**服务器中的文件资源。如果 URL 中没有路径名，访问默认文件

**解析结果**：

- 确定 **Web 服务器** 地址。
- 确定请求的 **文件名**。
- 浏览器根据这些信息生成 **HTTP 请求消息**。

## DNS

DNS 保存 **域名与 IP 地址** 的对应关系。能够将域名解析为 IP 地址，确保消息能够发送到目标服务器。

### 域名层级结构

DNS 使用句点分隔域名层级，如 `www.server.com`。

在域名中，越靠右的位置表示其层级越高。

**越右层级越高**：

1. 根域 DNS 服务器（`.`）
2. 顶级域 DNS 服务器（如 `.com`）
3. 权威 DNS 服务器（如 `server.com`）

客户端可通过任意 DNS 服务器逐层找到目标权威 DNS。

### 域名解析流程

**客户端**：

- 发出 DNS 请求：查询 `www.server.com` 的 IP。
- 优先查找浏览器缓存。

**本地 DNS**：

- 如果缓存有结果，直接返回。
- 如果没有，查询 **根域名服务器**。

**根 DNS**：指向顶级域服务器（如 `.com`）。

**顶级域 DNS**：指向权威 DNS 服务器（如 `server.com`）。

**权威 DNS**：返回域名对应的 IP 地址。

**本地 DNS**：

- 将 IP 地址返回给客户端。
- 缓存结果以便下次查询。

## 协议栈

负责将应用层（HTTP）数据传输到网络中。

**组成**：

1. **传输层**：TCP / UDP

   - 接受应用层委托，处理收发数据。

2. **网络层**：IP

   - 将数据拆分为网络包，控制发送。

   - 包含 **ICMP**（错误与控制信息）和 **ARP**（IP → MAC 地址查询）。

3. **网络接口层**：

   - 网卡驱动控制网卡硬件。

   - 网卡完成实际收发，将数字信息转为电信号。

## TCP

HTTP 基于 TCP 传输。

**特点**：

- 面向连接
- 提供可靠传输（顺序、确认、重传、流量控制、拥塞控制）

### TCP 报文头部的格式

**源端口 & 目标端口**：确定数据发送和接收的应用。

**序号 & 确认号**：解决乱序与丢包问题。

**状态位**：

- SYN：发起连接
- ACK：确认
- RST：重置连接
- FIN：结束连接

**窗口大小**：用于流量控制。

### TCP 三次握手（建立连接）

- **客户端 SYN → 服务器**（SYN-SENT）
- **服务器 SYN + ACK → 客户端**（SYN-RCVD）
- **客户端 ACK → 服务器**（ESTABLISHED）

**目的**：保证双方都能发送和接收数据。

### TCP 数据拆分

HTTP 消息可能超过 MSS（最大报文段长度）。TCP 将数据拆分为多块，每块放入独立网络包。

MTU：网络包最大长度（以太网一般 1500 字节）

MSS：除去 IP / TCP 头部后的 TCP 数据最大长度

### TCP 报文生成

**端口**：

- 浏览器监听端口（随机）
- Web 服务器监听端口（HTTP 默认 80，HTTPS 默认 443）

**数据部分**：HTTP 头 + HTTP 数据

组装后交给 **IP 模块** 发送。

## IP

### IP 包头格式

**源 IP**：客户端 IP

**目标 IP**：DNS 解析后的 Web 服务器 IP

**协议号**：06（TCP）

多网卡选择源 IP：

根据路由表判断使用哪个网卡。

默认网关：当其他条目无法匹配时，包发送给路由器。

## MAC

### MAC 包头格式

**包含信息**：

- 发送方 MAC
- 接收方 MAC

**协议类型**：

- 0800：IP
- 0806：ARP

### 获取 MAC 地址

**发送方**：网卡生产时写入 ROM

**接收方**：

1. 查 **ARP 缓存**
2. 若无，则发送 ARP 广播查询

**ARP 缓存**：保存查询结果，缓存几分钟（Linux `arp -a` 查看）

## 网卡

将内存中的网络包转为电信号在网线上传输

**流程**：

1. 网卡驱动将网络包复制到网卡缓存区
2. 加入报头与 **起始帧分界符**
3. 末尾加 **帧校验序列 FCS**（检测错误）
4. 转换为电信号发送

## 交换机

根据 MAC 地址将包转发到目的端口

**操作流程**：

1. 接收电信号 → 转数字信号
2. FCS 校验 → 放入缓冲区
3. 查询 **MAC 地址表**：
   - 含设备 MAC + 对应端口
   - 找到目标 MAC → 发到对应端口
   - 未找到 → 广播到除源端口之外的所有端口

**广播地址**：包发送到除源端口之外的所有端口

## 路由器

转发流程：

1. 接收包 → 电信号转数字信号
2. FCS 校验
3. 检查接收方 MAC 是否匹配（只接收匹配的包）

4. 去掉 MAC 头，读取 IP 头

5. 查询 **路由表**：

   - 网关为空 → 目标 IP = IP 头目标地址（最终目的地）

   - 网关有 IP → 转发到下一路由器

6. 查 ARP 缓存或发送 ARP 查询，获取下一跳 MAC 地址

7. 设置发送方 MAC 地址为输出端口 MAC

8. 转换为电信号 → 发送出去

注意：源 IP 和目标 IP 不变，MAC 地址会随每段链路变化

### 服务器 与 客户端

服务器接收流程：

1. 去掉 **MAC 头**，检查 MAC 地址是否匹配
2. 去掉 **IP 头**，检查 IP 地址
3. 读取 **TCP 头**：
   - 检查序列号
   - 检查端口号（HTTP 服务监听）
   - 放入缓存并返回 ACK
4. HTTP 进程生成响应，封装成 **HTTP 响应报文**
5. 添加 TCP / IP / MAC 头，发送给客户端

客户端接收流程：

1. 网络包通过路由器和交换机转发到客户端
2. 客户端去掉 MAC / IP / TCP 头
3. 提取 **HTTP 响应报文**
4. 浏览器渲染页面

连接关闭：

1. 客户端向服务器发起 **TCP 四次挥手**
2. 双方断开连接
