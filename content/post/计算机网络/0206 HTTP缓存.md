---
# 文章标题
title: 2.6 HTTP 缓存
# 文章内容摘要
# description:
# 文章内容关键字
keywords: HTTP 缓存机制, 强制缓存, 协商缓存, Cache-Control, Expires, ETag, Last-Modified, If-None-Match, If-Modified-Since, HTTP 性能优化, 浏览器缓存, 304 Not Modified, HTTP 缓存头, Web 前端优化, HTTP 缓存策略, HTTP 响应头, 网络性能提升, HTTP 缓存实现流程, 浏览器请求缓存
# 发表日期
date: 2025-09-23
summary: 本节详细介绍了 HTTP 缓存，包括缓存的目的、分类、强制缓存和协商缓存的实现方式，以及它们之间的关系。
# 分类
categories:
  - 计算机网络
# 标签
tags:
  - 计算机基础
  - 计算机网络
  - HTTP协议
---

## HTTP 缓存的目的

对于一些具有**重复性请求**的场景（如每次请求得到的数据都相同），可以将这对「请求-响应」的数据**缓存在本地**。这样下次请求时直接读取本地数据，无需通过网络获取服务器响应，从而显著提升 **HTTP/1.1** 的性能。

HTTP 协议在设计时已考虑缓存机制，头部中包含多个与缓存相关的字段。

HTTP 缓存的实现方式主要分为两类：**强制缓存（强缓存）**和**协商缓存**

## 强制缓存

只要浏览器判断缓存**未过期**，则**直接使用本地缓存**，无需与服务器通信。是否使用缓存的**主动权在浏览器**。

强制缓存通过以下两个 HTTP 响应头字段实现：

- **Cache-Control**：相对时间。
- **Expires**：绝对时间。

当同时存在时，**Cache-Control 优先级高于 Expires**。Cache-Control 设置更精细，推荐使用该字段。

实现流程：

- 第一次请求：浏览器请求服务器资源；服务器在响应头中添加 **Cache-Control** 字段，指定过期时间。
- 再次请求：浏览器根据上次请求时间与 Cache-Control 设置的过期时长计算资源是否过期；若**未过期** → 使用本地缓存；若**已过期** → 重新请求服务器。
- 服务器响应：收到新的请求后，更新响应头中的 **Cache-Control**。

## 协商缓存

由客户端与服务器**协商是否使用缓存**。服务器根据客户端提供的缓存标识，判断资源是否变更，并返回相应状态码。

当响应状态码为 **304 Not Modified** 时，表示可以使用本地缓存。

协商缓存可通过两组请求头与响应头字段实现：

1. 基于时间的实现：

**响应头字段**：`Last-Modified`（资源最后修改时间）

**请求头字段**：`If-Modified-Since`（上次修改时间）

工作流程:

- 第一次请求时，服务器返回资源，并在响应头中添加：Last-Modified: \<最后修改时间>
- 资源过期后再次请求时，浏览器在请求头中加入：If-Modified-Since: \<上次 Last-Modified 值>
- 服务器比较时间：
  - 若资源**修改时间较新** → 返回最新资源，状态码 **200 OK**；
  - 若资源**未修改** → 返回 **304 Not Modified**，浏览器使用缓存。

2. 基于唯一标识的实现:

**响应头字段**：`ETag`（资源唯一标识）

**请求头字段**：`If-None-Match`（上次 ETag 值）

工作流程:

- 第一次请求时，服务器在响应头中添加：ETag: \<唯一标识>
- 资源过期后再次请求时，浏览器在请求头中加入：If-None-Match: \<ETag 值>
- 服务器比较标识：
  - 若标识**相同** → 返回 **304 Not Modified**；
  - 若标识**不同** → 返回最新资源（200），并更新 ETag 值。

第一种实现方式是基于时间实现的，第二种实现方式是基于一个唯一标识实现的，相对来说后者可以更加准确地判断文件内容是否被修改，避免由于时间篡改导致的不可靠问题。

当响应头中同时存在 **ETag** 和 **Last-Modified** 时，服务器判断优先顺序为：**ETag > Last-Modified**：

**原因：**

- 文件未修改内容但修改时间变化，可能导致误判；
- `If-Modified-Since` 的精度仅到秒；
- 某些服务器无法准确获取文件修改时间。

协商缓存与强制缓存的关系：

- 协商缓存字段需**配合强制缓存字段（Cache-Control）**使用。
- 仅当**未命中强制缓存**时，才会发起带有协商缓存字段的请求。

使用 ETag 实现协商缓存的完整流程：

- **第一次请求**：服务器响应资源；响应头中包含 `ETag` 唯一标识。
- **浏览器再次请求**：检查强制缓存：
  - **未过期** → 使用本地缓存；
  - **已过期** → 在请求头中加入 `If-None-Match`（ETag 值）。
- **服务器处理请求**：比较当前资源的 ETag 与请求头中的 ETag：
  - 若相等 → 返回 **304 Not Modified**；
  - 若不相等 → 返回 **200 OK** 并更新 ETag。
- **浏览器处理响应**
  - 若状态码为 **304** → 从本地缓存加载；
  - 若为 **200** → 更新缓存内容与 ETag。
