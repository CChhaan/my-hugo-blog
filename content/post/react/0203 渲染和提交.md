---
# 文章标题
title: 2.3 渲染和提交
# 文章内容摘要
# description: 本文详细介绍了 Git 这一分布式版本控制系统的优点，对比了 Windows 与 macOS/Linux 系统下的常用命令，讲解了 vim 操作模式及常用命令，还阐述了 Git 的基本配置、特定项目配置和命令缩写设置等内容。
# 文章内容关键字
keywords: React 渲染流程, React 渲染机制, 初次渲染, 状态更新触发渲染, React 递归渲染, JSX 快照, React 提交阶段, DOM 更新流程, 最小化 DOM 更新, React 严格模式, 一次渲染的 state 快照, state 不可变渲染逻辑, state 批处理, 批量更新 state, 更新函数 setState 回调, 多次更新同一 state, React 性能优化, 组件纯函数渲染, React UI 更新原理
# 发表日期
date: 2025-10-11
summary: 本文介绍了 React 渲染和提交的步骤，包括触发一次渲染、React 渲染你的组件、React 把更改提交到 DOM 上以及渲染会及时生成一张快照等内容。
# 分类
categories:
  - React文档阅读
# 标签
tags:
  - react
  - 前端框架
  - 前端开发
  - 组件化开发
---

## 步骤 1: 触发一次渲染

渲染的两种原因

1. 组件的 **初次渲染**：当应用启动时触发，通过调用 `createRoot` 并传入目标 DOM 节点，使用组件调用 `render` 函数完成渲染。
2. 组件（或其祖先）**状态发生改变**：初次渲染后，可通过 `set` 函数 更新状态。更新状态会**自动将一次渲染送入队列**

## 步骤 2: React 渲染你的组件

React 调用组件的时机

- **初次渲染：** 调用根组件。
- **后续渲染：** 调用内部状态更新触发渲染的函数组件。

递归渲染过程：若组件返回另一个组件，React 会继续渲染该组件，过程持续到所有嵌套组件处理完毕，React 确定最终需要显示的内容。

渲染必须保持纯计算

- **输入相同 → 输出相同**：相同输入应返回相同 JSX。
- **只做自己的事情**：不能修改渲染前存在的对象或变量。

严格模式行为：React 会在开发时**调用组件两次**，用于发现不纯导致的问题。

## 步骤 3: React 把更改提交到 DOM 上

DOM 更新方式

- **初次渲染：** 通过 [`appendChild()`](https://developer.mozilla.org/docs/Web/API/Node/appendChild) 将新建 DOM 节点插入屏幕。
- **重渲染：** 应用最少的必要操作使 DOM 与最新渲染输出匹配。

DOM 更新原则：**React 仅在渲染之间存在差异时才会更改 DOM 节点。**

渲染完成后 React 更新 DOM，浏览器重新绘制屏幕。

## 渲染会及时生成一张快照

**正在渲染**：React 正在调用组件函数，你返回的 JSX 是 UI 在某一时刻的快照，JSX 中的 props、事件处理函数和内部变量都是 **根据当前渲染时的 state** 计算出来的。

重新渲染的过程：

1. React 再次调用你的组件函数。
2. 组件函数返回新的 JSX 快照。
3. React 更新界面以匹配此次快照。

state 存储在 React 内部，而非组件函数内部。React 在每次渲染时提供一张 **当次渲染对应的 state 快照**。返回的 JSX 会使用这些 state 值计算出一整套新的 props 与事件处理函数。

**设置 state 只会为下一次渲染变更 state 的值**。

**一次渲染内部，state 的值永远不会变化**，即使事件处理是异步执行的。

**React 会让 state 的值在一次渲染的所有事件处理函数中保持一致（固定）**。

## React 会对 state 更新进行批处理

**React 会等事件处理函数中的所有代码执行完毕后再处理所有 state 更新。**

这样可以在多个 state 更新时避免多次渲染；防止 UI 在部分 state 更新后出现“半成品”渲染；提升性能。

**React 不会跨多个需要刻意触发的事件（如多次点击）进行批处理。**每次点击等独立事件将分别完成更新。

## 在下次渲染前多次更新同一个 state

若希望在下一次渲染前多次更新同一个 state，应使用更新函数：`setNumber(n => n + 1)`而不是直接传入新值：`setNumber(number + 1)`

更新函数的执行流程：

1. React 将更新函数加入队列（所有事件处理函数执行结束后处理）。
2. 在下一次渲染时，React 会遍历队列并计算最终 state。

`setState(x)` 的行为类似于 `setState(n => x)`，只是未使用 `n`。

更新函数会在渲染期间执行，因此必须满足：**是纯函数**，**只返回结果，不产生副作用**（如设置 state 或执行其他操作）。

在严格模式中，React 会执行每个更新函数 **两次**（第二次结果被丢弃），用于发现潜在错误。

通常使用对应 state 变量的首字母作为更新函数的参数名称。
