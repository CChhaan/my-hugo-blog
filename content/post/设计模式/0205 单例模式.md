---
# 文章标题
title: 2.5 单例模式
# 文章内容摘要
# description: 本文详细介绍了 Git 这一分布式版本控制系统的优点，对比了 Windows 与 macOS/Linux 系统下的常用命令，讲解了 vim 操作模式及常用命令，还阐述了 Git 的基本配置、特定项目配置和命令缩写设置等内容。
# 文章内容关键字
keywords: 单例模式, Singleton 模式, 创建型设计模式, 全局唯一实例, getInstance, 延迟初始化, 私有构造函数, 全局访问点, 线程安全单例, 单例实现方法, 单例优缺点, 单例应用场景, 单例测试难点, 单例懒汉式, 单例饿汉式, 单例模式风险, 单例与全局变量比较, 单例设计原则, 多线程单例, 单例模式示例
# 发表日期
date: 2025-11-02
summary: 本节详细介绍了单例模式，包括其定义、分类、解决方案、模式结构、适合应用场景、实现方式、优缺点等内容。
# 分类
categories:
  - 设计模式
# 标签
tags:
  - 设计模式
---

## 定义

**单例模式（Singleton Pattern）** 是一种**创建型设计模式**，它能够 **保证一个类只有一个实例**，并提供一个 **访问该实例的全局节点**。

单例模式同时解决两件事（因此违反了单一职责原则）：

- **保证一个类只有一个实例**：再次创建时返回已存在的实例，而不是新对象。
- **提供一个全局访问节点**：类似全局变量，但能**保护该实例不被其他代码覆盖**。

## 解决方案

所有单例实现包含两步：

1. **将默认构造函数设为私有**，防止外部使用 `new` 创建对象。
2. **提供一个静态构建方法**（例如 `getInstance`）：

   该方法“偷偷”调用私有构造函数创建对象并将其保存在静态成员中，之后所有对该静态方法的调用都返回缓存的同一实例。

> 只要代码能访问单例类，就能调用它的静态方法；该方法始终返回相同对象。

## 模式结构

**单例类**

- 声明一个静态方法（例如 `getInstance`）来返回唯一实例。
- 构造函数对客户端隐藏（私有），**获取实例的方法** 是获取单例对象的**唯一方式**。

**客户端（Client）**

- 通过单例类的静态方法访问该实例，而不能直接 new 构造对象。

## 适合应用场景

- 当程序中某个类 **全局只需一个可用实例** 时，使用单例模式。

  单例禁止通过除特定构建方法外的任何方式创建该类对象，构建方法会创建新对象或在已创建时返回已有对象。

- 当需要 **更严格控制全局变量** 时，可用单例模式。

  与普通全局变量不同，单例保证只有一个实例，并且**无法被其他代码替换**（除非单例自身代码修改）。

**可调整性**：可以修改 `getInstance` 的实现以改变允许生成的实例数量

## 实现方式

1. 在类中添加一个 **私有静态成员变量** 用于保存单例实例。
2. 声明一个 **公有静态构建方法**（获取单例实例）。
3. 在静态方法中实现 **延迟初始化**：首次调用时创建新对象并存储在静态成员中；随后返回该实例。
4. 将类的构造函数设为 **私有**，使外部无法直接构造。
5. 检查客户端代码，将对构造函数的直接调用替换为对静态构建方法的调用。

## 优缺点

优点：

- **保证一个类只有一个实例**。
- **提供指向该实例的全局访问节点**。
- 可以**延迟初始化**，仅在首次请求时创建实例。

缺点：

- **违反单一职责原则**（同时负责实例唯一性与全局访问）。
- 可能掩盖不良设计（程序组件耦合过高）。
- **多线程环境下需特殊处理**，以避免多个线程同时创建多个实例。
- **单例的单元测试困难**：许多测试框架通过继承或替换方法来创建 mock。单例的私有构造与静态方法限制了这种替换，需仔细设计或避免使用单例以便测试。
