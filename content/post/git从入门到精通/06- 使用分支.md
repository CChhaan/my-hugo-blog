---
# 文章标题
title: 第六章 使用分支
# 文章内容摘要
# description:
# 文章内容关键字
keywords: Git, Git 分支，git branch, 分支合并，git rebase, 合并冲突，分支切换，分支删除恢复
summary: 本章介绍了 Git 分支的基本操作，包括创建、切换、合并、删除分支等，以及分支合并的原理和 rebase 的使用方法。
# 发表日期
date: 2025-07-05
# 分类
categories:
  - Git从入门到精通
# 标签
tags:
  - Git 分支
  - Git
  - 版本控制工具
---

## 分支的基本操作

1. **查看分支**

- 执行 git branch 命令，不带任何参数时，会输出当前项目中的所有分支，前面带有星号的分支表示当前所在分支（即 HEAD 指向的分支）。
- 扩展命令（面试高频）：
  - `git branch -r`：查看远程分支（如`origin/main`）。
  - `git branch -a`：查看本地 + 远程所有分支（远程分支以`remotes/`前缀显示）。
  - `git branch -v`：显示各分支最后一次提交信息（哈希 + 说明）。

2. **创建分支**

- 在 git branch 命令后加上想要创建的分支名称，即可基于当前分支为基准创建新分支（仅创建，不切换），例如 git branch cat。

3. **修改分支名称**

- 使用-m 参数可以修改分支名称，即使是 master 分支也能修改，且不会影响文件或目录（当前分支可省略旧名，直接`git branch -m <新名>`），如 git branch -m cat tiger。

4. **删除分支**

- 使用-d 参数可以删除不需要的分支，如 git branch -d dog。

- 若要删除的分支未被完全合并，-d 参数无法删除，此时可使用-D 参数强制删除，如 git branch -D dog。

- 当前所在的分支不能删除，需先切换到其他分支再进行删除操作。

5. **切换分支**

- 使用 git checkout 命令切换分支，如 git checkout dog，切换的分支必须已存在，否则会出错（Git 2.23 + 推荐用`git switch <分支名>`，更直观）。

- 若要切换的分支不存在，可在 git checkout 后加上-b 参数，若分支不存在则创建并切换过去，若已存在则直接切换，如 git checkout -b new_branch。

- 注意：切换分支前，需 commit 或 stash 工作区的修改（否则未提交的修改会被带到新分支）。

## 对分支的理解

- 可以将分支想象成一张贴纸，贴在某个 commit 上。当进行新的 commit 后，新的 commit 会指向其前一个 commit，当前分支（HEAD 所指分支）会贴到新的 commit 上，HEAD 也会随之前进。

- Git 中的分支并非通过复制目录或文件夹形成，它只是一个指向 commit 的指标。

## 切换分支的原理

- 切换分支时，Git 会用该分支指向的 commit 内容更新暂存区及工作目录，切换前的改动会保留在工作目录中不受影响。

- 同时，HEAD 会指向切换后的分支，即.git/HEAD 文件会相应改动。

- **注意**：若工作区有未提交的修改，且与目标分支的文件冲突，Git 会**禁止切换分支**（需先 commit 或 stash 修改）。

## 分支合并

1. **基本合并操作**

- 若要将 cat 分支合并到 master 分支，需先切换到 master 分支：git checkout master，再执行 git merge cat。

- 当 cat 和 dog 分支都来自 master 分支时，master 合并这两个分支会采用快转模式，直接获取分支成果，**不产生新 commit**；而 cat 与 dog 分支合并时，Git 会生成一个额外的 commit，该 commit 会指向两个分支，标记合并来源。

2. **非快转模式合并**

- 合并时加上--no-ff 参数，可避免使用快转模式，强制生成一个额外的合并 commit，如 git merge cat --no-ff。

3. **恢复误删的未合并分支**

- 若不小心删除了未合并的分支，可通过 git checkout -b <新分支名> b174a5a 命令恢复，其中 b174a5a 是被删除分支指向的 commit 的 SHA-1 值。

- 若未记住 SHA-1 值，可使用 reflog 命令查找（默认保留 30 天）。

- 合并的实质是分支指向的 commit，分支本身无法合并。

## 另一种合并方式：rebase

1. **基本使用**

- 执行 git rebase main，表示以 main 分支为新的参考基准重新定义当前分支。将当前分支（如`feature`）的提交 “嫁接” 到目标分支（如`main`）的最新提交上

- rebase 会改动历史记录，不应随意对已推出去的内容使用 rebase。使`feature`的提交历史看起来是基于`main`的最新状态开发的，历史更线性。

2. **与一般合并的区别**

- rebase 合并不会产生专门的合并 commit，原本的 commit 仍存在于 Git 空间中，但因无分支指向，可能会被逐渐边缘化直至被回收。

- 谁 rebase 谁会影响历史记录的先后顺序。

3. **取消 rebase**

- 一般合并可通过 git reset HEAD^ --hard 删除合并 commit，使分支退回合并前状态。

- 取消 rebase 可使用 reflog 找到 rebase 前的最后一个动作硬切回去，或利用 ORIG_HEAD（记录危险操作前 HEAD 的位置），执行 git reset ORIG_HEAD --hard。

4. **rebase 的优缺点**

- 优点：不会产生额外的合并 commit，历史记录顺序可按需求确定。

- 缺点：不如一般合并直观，易出错且冲突时可能中断，对已推送内容使用可能给他人带来困扰。通常用于整理未推送的乱序 commit，完成后再推送。

## 合并冲突解决

1. **一般合并冲突**

- Git 可检查简单冲突，并非改到同一文件就会冲突，但改到同一行则会出现冲突。

- 冲突段落会被标记，上方是 HEAD（当前分支）内容，中间是分割线，下方是其他分支内容。需确定采纳的内容并移除标记，修改后将文件加入暂存区，再执行 commit 完成合并。

2. **rebase 合并冲突**

- 冲突时 rebase 会中断，修正冲突文件内容后加入暂存区，执行 git rebase --continue 继续完成 rebase。

- 若为非文本文件冲突，可选择保留自己分支的内容：git checkout --ours 文件名，或保留别人分支的内容：git checkout --theirs 文件名，之后将文件加入暂存区准备 commit。

- 放弃解决：`git rebase --abort`。

## 分支的存储位置

- 分支存储在.git/refs/heads 目录中，文件内容为对应 commit 的 SHA-1 值。

- Git 在 HEAD 文件中记录当前所在分支，可用@代替 HEAD。

- .git 目录中的 ORIG_HEAD 文件会记录危险操作（如合并、rebase 等）前 HEAD 的位置，便于恢复。

## 从特定 commit 创建分支

- 先使用 git checkout 657fcea 回到该 commit 状态，再执行 git checkout -b bird 创建并切换到新分支，也可直接用 git branch bird 657fcea 创建分支。

- 使用 git checkout -b bird 657fcea 可一步完成创建并切换到基于特定 commit 的分支。
